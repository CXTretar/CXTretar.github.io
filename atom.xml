<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tretar&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-09-14T15:04:52.831Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Tretar</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>自定义NSURLProtocol实现WebView缓存以及科学上网</title>
    <link href="http://yoursite.com/2018/07/20/%E8%87%AA%E5%AE%9A%E4%B9%89NSURLProtocol%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%A1%B5%E7%BC%93%E5%AD%98%E4%BB%A5%E5%8F%8A%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    <id>http://yoursite.com/2018/07/20/自定义NSURLProtocol实现网页缓存以及科学上网/</id>
    <published>2018-07-20T02:31:08.000Z</published>
    <updated>2019-09-14T15:04:52.831Z</updated>
    
    <content type="html"><![CDATA[<h4 id="NSURLProtocol是什么？"><a href="#NSURLProtocol是什么？" class="headerlink" title="NSURLProtocol是什么？"></a>NSURLProtocol是什么？</h4><p>NSURLProtocol是 iOS里面的<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html" target="_blank" rel="noopener">URL Loading System</a>的一部分，它是一个抽象类，不能去实例化它，只能子类化NSURLProtocol，然后在使用的时候注册子类。</p><p><img src="/2018/07/20/自定义NSURLProtocol实现网页缓存以及科学上网/NSURLProtocol.png" alt="NSURLProtocol"></p><h4 id="NSURLProtocol能做什么？"><a href="#NSURLProtocol能做什么？" class="headerlink" title="NSURLProtocol能做什么？"></a>NSURLProtocol能做什么？</h4><p>在每一个 <code>HTTP</code> 请求开始时，<code>URL Loading System</code> 会创建一个合适的 <code>NSURLProtocol</code> 对象处理对应的 URL 请求，而我们需要做的就是写一个继承自 <code>NSURLProtocol</code> 的类，并通过 <code>- registerClass:</code> 方法注册我们的协议类，然后 <code>URL Loading System</code> 就会在请求发出时使用我们创建的 <code>NSURLProtocol</code> 对象对该请求进行处理。</p><p>这样，我们就可以使用 <code>NSURLProtocol</code> 来处理所有的网络请求，实现以下一些功能：</p><ul><li>可以拦截 UIWebView 的网络请求。</li><li>重定向网络请求（可以解决 DNS 域名劫持问题）</li><li>缓存网页内容</li><li>自定义 Response （过滤敏感信息）</li><li>全局网络请求设置</li></ul><p>苹果官方文档中的 <a href="https://developer.apple.com/library/ios/samplecode/CustomHTTPProtocol/CustomHTTPProtocol.zip" target="_blank" rel="noopener">CustomHTTPProtocol</a> 对自定义 <code>NSURLProtocol</code> 有了一些具体的介绍，你可以点击<a href="https://developer.apple.com/library/ios/samplecode/CustomHTTPProtocol/CustomHTTPProtocol.zip" target="_blank" rel="noopener">这里</a>下载源代码。</p><p>基于官方的 Demo，我们来对 <code>NSURLProtocol</code> 做进一步的处理，使其能够对我们请求的网页内容缓存，甚至可以通过连接代理服务器来科学上网，需要提醒的是，这里的科学上网只能够在注册该 <code>NSURLProtocol</code> 的条件下实现，也就是说是 App 内部的网页可以通过代理服务器请求打开。</p><p><a href="https://github.com/CXTretar/CXProxyURLProtocol" target="_blank" rel="noopener">项目地址</a> </p><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><ul><li>在需要开启代理的时候注册 <code>CXProxyURLProtocol</code> 。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[CXProxyProtocolManager registerProxyURLProtocol];</span><br></pre></td></tr></table></figure><ul><li>在需要关闭代理的时候注销 <code>CXProxyURLProtocol</code> 。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[CXProxyProtocolManager unregisterProxyURLProtocol];</span><br></pre></td></tr></table></figure><ul><li>设置拦截的请求服务类型或者代理服务器 ip 地址和端口号。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> CXProxyURLProtocol 可支持的URLSchemes</span><br><span class="line"></span><br><span class="line"> @return URLSchemes</span><br><span class="line"> */</span><br><span class="line">+ (NSSet *)supportedSchemes;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 设置 CXProxyURLProtocol 可支持的URLSchemes, 默认为 [http,https]</span><br><span class="line"></span><br><span class="line"> @param supportedSchemes URLSchemes like: http https</span><br><span class="line"> */</span><br><span class="line">+ (void)setSupportedSchemes:(NSSet *)supportedSchemes;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> 设置代理服务器ip地址以及端口号 http/https 连接方式</span><br><span class="line"> </span><br><span class="line"> @param HTTPProxyHost ip地址</span><br><span class="line"> @param HTTPProxyPort 端口号</span><br><span class="line"> */</span><br><span class="line">+ (void)setHTTPProxyHost:(NSString *)HTTPProxyHost andHTTPProxyPort:(NSNumber *)HTTPProxyPort;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;NSURLProtocol是什么？&quot;&gt;&lt;a href=&quot;#NSURLProtocol是什么？&quot; class=&quot;headerlink&quot; title=&quot;NSURLProtocol是什么？&quot;&gt;&lt;/a&gt;NSURLProtocol是什么？&lt;/h4&gt;&lt;p&gt;NSURLProto
      
    
    </summary>
    
      <category term="iOS开发" scheme="http://yoursite.com/categories/iOS%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="技术" scheme="http://yoursite.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>iOS组件化-提交组件代码到cocoapods作为框架</title>
    <link href="http://yoursite.com/2018/06/28/iOS%E7%BB%84%E4%BB%B6%E5%8C%96-%E6%8F%90%E4%BA%A4%E7%BB%84%E4%BB%B6%E4%BB%A3%E7%A0%81%E5%88%B0cocoapods%E4%BD%9C%E4%B8%BA%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2018/06/28/iOS组件化-提交组件代码到cocoapods作为框架使用/</id>
    <published>2018-06-28T02:28:47.000Z</published>
    <updated>2018-07-20T05:39:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>使用CocoaPods非常高效地将一些第三方类库导入到我们的项目中，给我们的开发带来了极大的便利，作为一个iOS开发者，大家肯定有自己封装的一些小组件，假如能让自己封装的组件支持pod集成，就能提供给其他开发者使用，岂不美哉。接下来将用一个Demo来演示组件化操作流程以及注意事项。</p><h2 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h2><h3 id="1-上传项目源码"><a href="#1-上传项目源码" class="headerlink" title="1.上传项目源码"></a>1.上传项目源码</h3><p>在github上创建仓库的流程我就不累述了，首先把项目源码上传到github仓库再clone到本地，如果项目本来就在github的仓库中，直接clone到本地即可，这里以CXDatePickerView为例，<a href="https://github.com/CXTretar/CXDatePickerView" target="_blank" rel="noopener">Demo项目地址</a>。</p><h3 id="2-创建项目的podspec文件"><a href="#2-创建项目的podspec文件" class="headerlink" title="2.创建项目的podspec文件"></a>2.创建项目的podspec文件</h3><p>用终端命令cd打开本地项目文件夹并执行如下命令:<br><code>$ pod spec create CXDatePickerView</code><br>这时候文件夹中就生成一个CXDatePickerView.podspec文件，可以直接用xcode打开。<br>终端命令:<br><code>open -a Xcode CXDatePickerView.podspec</code><br>刚生成的文件有很多不必要的注释，可以删除，需要保留的配置字段，可以查看<a href="http://guides.cocoapods.org/syntax/podspec.html" target="_blank" rel="noopener">http://guides.cocoapods.org/syntax/podspec.html</a>。<br>Demo中保留了以下字段：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Pod::Spec.new do |s|</span><br><span class="line"></span><br><span class="line">  s.name         = &quot;CXDatePickerView&quot;   //  名称</span><br><span class="line">  s.version      = &quot;0.1.1&quot;              //  版本号</span><br><span class="line">  s.summary      = &quot;CXDatePickerView&quot;   //  简要说明</span><br><span class="line"></span><br><span class="line">  s.description  = &lt;&lt;-DESC</span><br><span class="line">                   This is a custom date picker view that provides a number of modifiable UI interfaces.</span><br><span class="line">                   DESC                 //  功能描述</span><br><span class="line"></span><br><span class="line">  s.homepage     = &quot;https://github.com/CXTretar/CXDatePickerView&quot; //项目主页</span><br><span class="line">  s.license      = &quot;MIT&quot;                //  许可证</span><br><span class="line"></span><br><span class="line">  s.author       = &#123; &quot;CXTretar&quot; =&gt; &quot;misscxuan@163.com&quot; &#125; //  所有者</span><br><span class="line"></span><br><span class="line">  s.platform     = :ios, &quot;8.0&quot;          //  系统版本</span><br><span class="line"></span><br><span class="line">  s.source       = &#123; :git =&gt; &quot;https://github.com/CXTretar/CXDatePickerView.git&quot;, :tag =&gt; s.version.to_s &#125; //  项目源地址</span><br><span class="line"></span><br><span class="line">  s.source_files  = &quot;CXDatePickerView/CXDatePickerView/*.&#123;h,m&#125;&quot; // 关联的源文件</span><br><span class="line"></span><br><span class="line">  s.requires_arc = true                 // 是否支持ARC</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>在这些字段中 <code>s.platform</code> 和 <code>s.source_files</code> 需要特别注意。<br><code>s.platform</code> 系统版本不要写的太低，不然上传到cocoapods时会因为不支持MRC而出现一些不必要的警告，在使用时也会出现多余的警告，建议填写”8.0”。<br><code>s.source_files</code> 是你要上传的组件文件夹地址，一定要是正确的路径，不然在上传到cocoapods时会出现<code>[iOS] file patterns: The &#39;source_files&#39; pattern did not match any file.</code>错误。填写的路径格式为 <code>项目文件夹name/组件文件夹name/*.{h,m}</code>，假如组件文件夹中还有其他文件夹，则为 <code>项目文件夹name/组件文件夹name/**/*.{h,m}</code>。</p><h3 id="3-验证podspec文件"><a href="#3-验证podspec文件" class="headerlink" title="3.验证podspec文件"></a>3.验证podspec文件</h3><p>编辑完podspec文件后需要验证该文件是否可用，podspec文件不允许有任何的Warning或者Error<br>终端命令:<br><code>$ pod lib lint</code><br>如果出现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-&gt; CXDatePickerView (0.0.1)</span><br><span class="line"></span><br><span class="line">CXDatePickerView passed validation.</span><br></pre></td></tr></table></figure></p><p>则说明验证通过，否则，就需要根据提示修改podspec文件再次验证直到验证通过。<br>因为Xcode允许警告存在，所以可以通过命令屏蔽警告<br><code>$ pod lib lint --allow-warnings</code><br>如果出现Error但是提示信息不足，可以添加–verbose 以获取更多错误信息<br><code>$ pod lib lint --verbose</code></p><h3 id="4-上传podspec文件"><a href="#4-上传podspec文件" class="headerlink" title="4.上传podspec文件"></a>4.上传podspec文件</h3><p>podspec文件中需要指定的tag，完成上述操作后给项目打tag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -m&quot;release CXDatePickerView with podspec&quot; &quot;0.0.1&quot;</span><br><span class="line">$ git push --tags</span><br></pre></td></tr></table></figure></p><p>接下来就需要将podspec文件上传至CocoaPod官方库，这里需要用到 pod trunk 账号，相信很多人都还没有注册过。这里简要说明一下注册流程：</p><h5 id="①-终端注册trunk账号"><a href="#①-终端注册trunk账号" class="headerlink" title="①.终端注册trunk账号"></a>①.终端注册trunk账号</h5><p><code>$ pod trunk register &#39;邮箱&#39; &#39;用户名&#39; --description=&#39;电脑描述&#39;</code><br>例如<br><code>$ pod trunk register &#39;misscxuan@163.com&#39; &#39;CXTretar&#39; --description=&#39;macbook pro&#39;</code><br>注册成功的话会回复<br><code>[!] Please verify the session by clicking the link in the verification email that has been sent to misscxuan@163.com</code></p><h5 id="②-查收邮件"><a href="#②-查收邮件" class="headerlink" title="②.查收邮件"></a>②.查收邮件</h5><p>如果是QQ邮箱，可能会被放到“垃圾箱”中，并不一定是“收件箱”。<br>点击邮件中的链接：<br><code>https://trunk.cocoapods.org/sessions/verify/xxxx</code></p><h5 id="③-接下来查看个人信息"><a href="#③-接下来查看个人信息" class="headerlink" title="③.接下来查看个人信息"></a>③.接下来查看个人信息</h5><p><code>$ pod trunk me</code><br>结果信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- Name:     CXTretar</span><br><span class="line">- Email:    misscxuan@163.com</span><br><span class="line">- Since:    June 27th, 01:08</span><br><span class="line">- Pods:</span><br><span class="line">  - CXDatePickerView</span><br><span class="line">- Sessions:</span><br><span class="line">  - June 27th, 01:08 - November 3rd, 01:09. IP: xxx.xxx.xxx.xxx</span><br><span class="line">  Description: macbook pro</span><br></pre></td></tr></table></figure><p>到这一步就注册成功了，假如遇到 <code>NoMethodError - undefined method &#39;last&#39; for #&lt;Netrc::Entry:0x007fc59c246378&gt;</code> 这样的问题需要尝试更新gem源或者pod：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem update --system</span><br><span class="line">$ sudo gem install cocoapods</span><br><span class="line">$ sudo gem install cocospods-trunk</span><br></pre></td></tr></table></figure></p><p>如果遇到 <code>[!] Authentication token is invalid or unverified. Either verify it with the email that was sent or register a new session.</code> 请重新再注册一次。<br>pod trunk 设置完毕后执行终端命令:<br><code>$ pod trunk push CXDatePickerView.podspec</code><br>发布时可以允许警告：<br><code>$ pod trunk push --allow-warnings CXDatePickerView.podspec</code><br>这个过程可能会比较耗时，需要耐心等待，假如有VPN工具的话，建议开启VPN后再进行这一步。<br>成功时会显示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Updating spec repo `master`</span><br><span class="line">Validating podspec</span><br><span class="line"> -&gt; CXDatePickerView (0.0.1)</span><br><span class="line"> </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"> 🎉  Congrats</span><br><span class="line"></span><br><span class="line"> 🚀  CXDatePickerView (0.0.1) successfully published</span><br><span class="line"> 📅  June 28th, 01:22</span><br><span class="line"> 🌎  https://cocoapods.org/pods/CXDatePickerView</span><br><span class="line"> 👍  Tell your friends!</span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><h3 id="5-搜索组件框架"><a href="#5-搜索组件框架" class="headerlink" title="5.搜索组件框架"></a>5.搜索组件框架</h3><p>此时你的组件库已经上传至cocoapods官方库中，可以这样子搜索<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pod setup </span><br><span class="line">$ pod repo update</span><br><span class="line">$ pod search CXDatePickerView</span><br></pre></td></tr></table></figure></p><p>假如搜索结果为 <code>[!] Unable to find a pod with name, author, summary, or description matching &#39;xxxx&#39;</code>，说明你的pod搜索库还没有更新，解决方法是通过Finder前往资源库去删除缓存中的search_index.json，路径为<code>~/Library/Caches/CocoaPods</code>，删除search_index.json，再重新调用 <code>pod search CXDatePickerView</code> 代码就能够搜索到你刚上传的组件库。</p><p>完结散花(<em>^▽^</em>)，希望这篇教程对你有帮助！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h2&gt;&lt;p&gt;使用CocoaPods非常高效地将一些第三方类库导入到我们的项目中，给我们的开发带来了极大的便利，作为一个iOS开发者，大家肯定有自己封装的
      
    
    </summary>
    
      <category term="iOS开发" scheme="http://yoursite.com/categories/iOS%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="技术" scheme="http://yoursite.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2018/03/21/hello-world/"/>
    <id>http://yoursite.com/2018/03/21/hello-world/</id>
    <published>2018-03-21T02:21:47.000Z</published>
    <updated>2018-06-28T08:10:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>花了点时间搞了自己的博客，感觉么么哒😘，希望能多上传点文章  ヾ(◍°∇°◍)ﾉﾞ。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;花了点时间搞了自己的博客，感觉么么哒😘，希望能多上传点文章  ヾ(◍°∇°◍)ﾉﾞ。&lt;/p&gt;

      
    
    </summary>
    
      <category term="生活感想" scheme="http://yoursite.com/categories/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%83%B3/"/>
    
    
      <category term="杂谈" scheme="http://yoursite.com/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
</feed>
