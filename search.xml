<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2018/03/21/hello-world/</url>
    <content><![CDATA[<p>èŠ±äº†ç‚¹æ—¶é—´æäº†è‡ªå·±çš„åšå®¢ï¼Œæ„Ÿè§‰ä¹ˆä¹ˆå“’ğŸ˜˜ï¼Œå¸Œæœ›èƒ½å¤šä¸Šä¼ ç‚¹æ–‡ç«   ãƒ¾(â—Â°âˆ‡Â°â—)ï¾‰ï¾ã€‚</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ç”Ÿæ´»æ„Ÿæƒ³</category>
      </categories>
      <tags>
        <tag>æ‚è°ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>Runtime çŸ¥è¯†ç‚¹ï¼ˆä¸€ï¼‰OCå¯¹è±¡çš„æœ¬è´¨</title>
    <url>/2020/03/02/runtime-zhi-shi-dian-yi/</url>
    <content><![CDATA[<h2 id="Runtimeæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Runtimeæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Runtimeæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Runtimeæ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul>
<li>OCæ˜¯ä¸€é—¨åŠ¨æ€æ€§æ¯”è¾ƒå¼ºçš„ç¼–ç¨‹è¯­è¨€ï¼Œå…è®¸å¾ˆå¤šæ“ä½œæ¨è¿Ÿåˆ°ç¨‹åºè¿è¡Œæ—¶å†è¿›è¡Œï¼ŒOCçš„åŠ¨æ€æ€§å°±æ˜¯ç”±Runtimeæ¥æ”¯æ’‘å’Œå®ç°çš„ã€‚</li>
<li>Runtimeæ˜¯ä¸€å¥—æ¯”è¾ƒåº•å±‚çš„çº¯Cè¯­è¨€APIï¼Œå±äº1ä¸ªCè¯­è¨€åº“ï¼ŒåŒ…å«äº†å¾ˆå¤šåº•å±‚çš„Cè¯­è¨€APIã€‚</li>
<li>å¹³æ—¶ç¼–å†™çš„OCä»£ç ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶å®æœ€ç»ˆä¼šè½¬æ¢æˆRuntimeçš„Cè¯­è¨€ä»£ç ï¼ŒRuntimeæ˜¯OCçš„å¹•åå·¥ä½œè€…ã€‚</li>
<li>OCéœ€è¦Runtimeæ¥åˆ›å»ºç±»å’Œå¯¹è±¡ï¼Œè¿›è¡Œæ¶ˆæ¯å‘é€å’Œè½¬å‘ã€‚</li>
</ul>
<blockquote>
<p><strong>å°ç»“ï¼š</strong> <strong>OCä»£ç å…·æœ‰è¿è¡Œæ—¶ã€åŠ¨æ€ç‰¹æ€§ï¼Œå¼€å‘æ—¶åªç®¡å†™ä½ çš„OCä»£ç å°±è¡Œï¼Œruntimeæœºåˆ¶è‡ªåŠ¨åœ¨å¹•åè¾›å‹¤åŠ³ä½œç€ã€‚</strong></p>
</blockquote>
<p><strong><em>è¦äº†è§£Runtimeæœºåˆ¶çš„åŸç†å’Œè¿ç”¨ï¼Œé¦–å…ˆæˆ‘ä»¬å¿…é¡»å…ˆæ¥æ¢å¯»OCå¯¹è±¡çš„æœ¬è´¨ï¼Œäº†è§£OCå¯¹è±¡çš„ç›¸å…³çŸ¥è¯†</em></strong></p>
<h2 id="OCå¯¹è±¡çš„åˆ†ç±»"><a href="#OCå¯¹è±¡çš„åˆ†ç±»" class="headerlink" title="OCå¯¹è±¡çš„åˆ†ç±»"></a>OCå¯¹è±¡çš„åˆ†ç±»</h2><p>OCå¯¹è±¡ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‰ç§</p>
<ul>
<li><strong>instanceå¯¹è±¡ï¼ˆå®ä¾‹å¯¹è±¡ï¼‰</strong></li>
<li><strong>classå¯¹è±¡ï¼ˆç±»å¯¹è±¡ï¼‰</strong></li>
<li><strong>meta-classå¯¹è±¡ï¼ˆå…ƒç±»å¯¹è±¡ï¼‰</strong></li>
</ul>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰€æœ‰çš„å®ä¾‹å¯¹è±¡éƒ½æ˜¯ç”±å…¶å¯¹åº”çš„ç±»å®ä¾‹åŒ–è€Œæ¥ï¼Œå…¶å®ç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡ï¼Œç±»å¯¹è±¡æ˜¯ç”±ç¼–è¯‘å™¨åˆ›å»ºçš„ï¼Œå³åœ¨ç¼–è¯‘æ—¶æ‰€è°“çš„ç±»ï¼Œå°±æ˜¯æŒ‡ç±»å¯¹è±¡ã€‚è€Œç±»å¯¹è±¡æ˜¯å…ƒç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå…ƒç±»æè¿°äº†ä¸€ä¸ªç±»å¯¹è±¡ï¼Œå°±åƒç±»å¯¹è±¡æè¿°äº†å®ä¾‹å¯¹è±¡ä¸€æ ·ã€‚å…ƒç±»æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿåº”è¯¥æ˜¯å…¶ä»–ç±»çš„å®ä¾‹ï¼Œå®é™…ä¸Šå…ƒç±»å¯¹è±¡æ˜¯æ ¹å…ƒç±»(Root classâ€™s meta-class)çš„å®ä¾‹ï¼Œè€Œæ ¹å…ƒç±»æ˜¯å…¶è‡ªèº«çš„å®ä¾‹ï¼Œå³æ ¹å…ƒç±»çš„isaæŒ‡é’ˆæŒ‡å‘è‡ªèº«ã€‚</p>
<p><img src="/CXTretar/CXTretar.github.io/2020/03/02/runtime-zhi-shi-dian-yi/1583287598973.jpg" alt=""></p>
<h2 id="instance-çš„ç»“æ„"><a href="#instance-çš„ç»“æ„" class="headerlink" title="instance çš„ç»“æ„"></a>instance çš„ç»“æ„</h2><p>åœ¨ Objective-C ä¸­çš„ Foundation æ¡†æ¶å¯¹ NSObjectå¯¹è±¡çš„æè¿°å¦‚ä¸‹</p>
<pre class=" language-objective-c"><code class="language-objective-c">@interface NSObject <NSObject> {
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wobjc-interface-ivars"
    Class isa  OBJC_ISA_AVAILABILITY;
#pragma clang diagnostic pop
}
</code></pre>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒOCåº•å±‚æ˜¯C/C++ä»£ç æ¥å®ç°çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Clangå°†OCæ–‡ä»¶è½¬åŒ–ä¸ºC++æ–‡ä»¶æ¥æ¢å¯»OCå¯¹è±¡çš„æœ¬è´¨ã€‚</p>
<h4 id="Clang-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Clang-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Clang æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Clang æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Clangæ˜¯ä¸€ä¸ªCè¯­è¨€ã€C++ã€Objective-Cã€Objective-C++è¯­è¨€çš„è½»é‡çº§ç¼–è¯‘å™¨ã€‚å®˜æ–¹ä»‹ç»ï¼š<a href="http://clang.llvm.org/docs/CommandGuide/clang.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>
<h4 id="ä½¿ç”¨-Xcode-ClangæŒ‡ä»¤å°†OCä»£ç è½¬æ¢ä¸ºC-ä»£ç "><a href="#ä½¿ç”¨-Xcode-ClangæŒ‡ä»¤å°†OCä»£ç è½¬æ¢ä¸ºC-ä»£ç " class="headerlink" title="ä½¿ç”¨ Xcode ClangæŒ‡ä»¤å°†OCä»£ç è½¬æ¢ä¸ºC++ä»£ç "></a><strong>ä½¿ç”¨ Xcode ClangæŒ‡ä»¤å°†OCä»£ç è½¬æ¢ä¸ºC++ä»£ç </strong></h4><p><code>xcrun  -sdk  iphoneos  clang  -arch  arm64  -rewrite-objc  xxxx.m  -o  xxxx.cpp</code></p>
<p>å¦‚æœéœ€è¦é“¾æ¥å…¶ä»–æ¡†æ¶ï¼Œä½¿ç”¨-frameworkå‚æ•°ã€‚æ¯”å¦‚-framework UIKit</p>
<p><code>xcrun  -sdk  iphoneos  clang  -arch  arm64  -rewrite-objc  -framework UIKit  xxxx.m  -o  xxxx.cpp</code></p>
<p>å¦‚æœéœ€è¦æ”¯æŒARCã€æŒ‡å®šè¿è¡Œæ—¶ç³»ç»Ÿç‰ˆæœ¬ã€‚æ¯”å¦‚</p>
<p><code>xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc -fobjc-arc -fobjc-runtime=ios-8.0.0 main.m</code></p>
<p>ç°åœ¨æˆ‘ä»¬å°†è¿™æ ·ä¸€ä¸ªmain.mæ–‡ä»¶è½¬æ¢æˆmain.cppæ–‡ä»¶</p>
<pre class=" language-objective-c"><code class="language-objective-c">#import <Foundation/Foundation.h>

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        NSObject *objc = [[NSObject alloc] init];
    }
    return 0;
}
</code></pre>
<p>åœ¨main.cppæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€ä¸ªç»“æ„</p>
<pre class=" language-objective-c"><code class="language-objective-c">struct NSObject_IMPL {
    Class isa;
};
</code></pre>
<p>è¿™å°±æ˜¯ NSObject å¯¹è±¡åœ¨åº•å±‚ä¸­çš„å®ç°ï¼Œä»–è¢«è½¬æ¢æˆä¸€ä¸ªåªå«æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ isa çš„ç»“æ„ä½“ NSObject_IMPLã€‚</p>
<p>æ¥ä¸‹æ¥å¯¹ç»§æ‰¿äºNSObjectçš„å¯¹è±¡è¿›è¡ŒOCä»£ç è½¬æ¢</p>
<pre class=" language-objective-c"><code class="language-objective-c">@interface Animal : NSObject {
    @public
    int _age;
}

@end

@implementation Animal

@end

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        Animal *animal = [[Animal alloc] init];
        animal->_age = 2;
    }
    return 0;
}

</code></pre>
<p>åœ¨ç”Ÿæˆçš„main.cppæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€ä¸ªç»“æ„</p>
<pre class=" language-objective-c"><code class="language-objective-c">struct Animal_IMPL {
    Class isa;
    int _age;
};
</code></pre>
<blockquote>
<p><strong>å°ç»“ï¼š</strong> <strong>å¯ä»¥çœ‹å‡ºinstanceå¯¹è±¡åœ¨åº•å±‚ä¸­å®é™…ä¸Šè¢«è½¬åŒ–æˆäº†å­˜å‚¨ç€isaæŒ‡é’ˆå’Œå…¶ä»–æˆå‘˜å˜é‡çš„ä¸€ä¸ªç»“æ„ä½“</strong></p>
</blockquote>
<h2 id="class-çš„ç»“æ„"><a href="#class-çš„ç»“æ„" class="headerlink" title="class çš„ç»“æ„"></a>class çš„ç»“æ„</h2><p>åœ¨ instance å¯¹è±¡çš„ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>Class isa</code>è¿™ä¸ªæŒ‡é’ˆï¼Œæ‰€è°“çš„<code>Class</code>ç±»å‹æŒ‡ä»£çš„æ˜¯<code>typedef struct objc_class *Class</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„class å¯¹è±¡ï¼Œåœ¨<code>runtime.h</code>æ–‡ä»¶ä¸­æˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾åˆ°<code>objc_class</code>çš„å…·ä½“ç»“æ„</p>
<pre class=" language-objective-c"><code class="language-objective-c">struct objc_class {
    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;

#if !__OBJC2__
    Class _Nullable super_class                              OBJC2_UNAVAILABLE;
    const char * _Nonnull name                               OBJC2_UNAVAILABLE;
    long version                                             OBJC2_UNAVAILABLE;
    long info                                                OBJC2_UNAVAILABLE;
    long instance_size                                       OBJC2_UNAVAILABLE;
    struct objc_ivar_list * _Nullable ivars                  OBJC2_UNAVAILABLE;
    struct objc_method_list * _Nullable * _Nullable methodLists                    OBJC2_UNAVAILABLE;
    struct objc_cache * _Nonnull cache                       OBJC2_UNAVAILABLE;
    struct objc_protocol_list * _Nullable protocols          OBJC2_UNAVAILABLE;
#endif

} OBJC2_UNAVAILABLE;
</code></pre>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸‹è½½ <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">objc4</a>æºç æ¥æŸ¥çœ‹<code>objc_class</code>ï¼Œæ›´ä¸ºå‡†ç¡®ï¼Œåœ¨<code>objc-runtime-new.h</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p>
<pre class=" language-objective-c"><code class="language-objective-c">struct objc_object {
private:
    isa_t isa;
  ...
}

struct objc_class : objc_object {
    // Class ISA;
    Class superclass;
    cache_t cache;             // formerly cache pointer and vtable
    class_data_bits_t bits;    // class_rw_t * plus custom rr/alloc flags

    class_rw_t *data() const {
        return bits.data();
    }
    ...
}

struct class_rw_t {
    // Be warned that Symbolication knows the layout of this structure.
    uint32_t flags;
    uint16_t version;
    uint16_t witness;

    const class_ro_t *ro;

    method_array_t methods;
    property_array_t properties;
    protocol_array_t protocols;
    ...
}

struct class_ro_t {
    uint32_t flags;
    uint32_t instanceStart;
    uint32_t instanceSize;
#ifdef __LP64__
    uint32_t reserved;
#endif

    const uint8_t * ivarLayout;

    const char * name;
    method_list_t * baseMethodList;
    protocol_list_t * baseProtocols;
    const ivar_list_t * ivars;

    const uint8_t * weakIvarLayout;
    property_list_t *baseProperties;
        ...
}
</code></pre>
<p>ç”±è¿™äº›ç»“æ„æˆ‘ä»¬å¯ä»¥çœ‹å‡ºclasså¯¹è±¡åº•å±‚å®é™…ä¸Šæ˜¯objc_classè¿™ä¸ªç»“æ„ä½“ï¼Œç»§æ‰¿äºobjc_objectï¼ˆæ ¹ç±»ï¼‰ï¼Œclasså¯¹è±¡å†…éƒ¨ä¸»è¦åŒ…å«äº†ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>isa </strong> åœ¨arm64æ¶æ„ä¹‹å‰ï¼Œisaå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æŒ‡é’ˆï¼Œå­˜å‚¨ç€Classã€Meta-Classå¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ä»arm64æ¶æ„å¼€å§‹ï¼Œå¯¹isaè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå˜æˆäº†ä¸€ä¸ªå…±ç”¨ä½“ï¼ˆunionï¼‰ç»“æ„ï¼Œè¿˜ä½¿ç”¨ä½åŸŸæ¥å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ã€‚</li>
<li><strong>superclass</strong> æŒ‡å‘è¯¥ç±»çš„çˆ¶ç±»ã€‚</li>
<li><strong>name</strong> è¯¥ç±»ç±»åã€‚</li>
<li><strong>version</strong> è¯¥ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</li>
<li><strong>instance_size</strong>  è¯¥ç±»çš„å®ä¾‹å¯¹è±¡çš„å†…å­˜å ç”¨å¤§å°ã€‚</li>
<li><strong>properties</strong> è¯¥ç±»çš„å±æ€§ä¿¡æ¯åˆ—è¡¨ã€‚</li>
<li><strong>ivars </strong>è¯¥ç±»ä¸­æ‰€æœ‰æˆå‘˜å˜é‡çš„åˆ—è¡¨ï¼Œä½¿ç”¨åœºæ™¯ï¼šæˆ‘ä»¬åœ¨å­—å…¸è½¬æ¢æˆæ¨¡å‹çš„æ—¶å€™éœ€è¦ç”¨åˆ°è¿™ä¸ªåˆ—è¡¨æ‰¾åˆ°å±æ€§çš„åç§°ï¼Œå»å–å­—å…¸ä¸­çš„å€¼ï¼ŒKVCèµ‹å€¼ï¼Œæˆ–è€…ç›´æ¥Runtimeèµ‹å€¼ã€‚</li>
<li><strong>methodLists / methods</strong> å­˜å‚¨è¯¥ç±»ä¸­çš„å¯¹è±¡æ–¹æ³•ä¿¡æ¯åˆ—è¡¨ï¼Œç±»ä¸­æ‰€æœ‰å¯¹è±¡æ–¹æ³•çš„åˆ—è¡¨ï¼Œä½¿ç”¨åœºæ™¯ï¼šå¦‚åœ¨ç¨‹åºä¸­å†™å¥½æ–¹æ³•ï¼Œé€šè¿‡å¤–éƒ¨è·å–åˆ°æ–¹æ³•åç§°å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå­—ç¬¦ä¸²å¾—åˆ°æ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°å¤–éƒ¨æ§åˆ¶Appå·²çŸ¥æ–¹æ³•ã€‚</li>
<li><strong>cache</strong> ä¸»è¦ç”¨äºç¼“å­˜å¸¸ç”¨æ–¹æ³•åˆ—è¡¨ï¼Œæ¯ä¸ªç±»ä¸­æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå³ä½¿æ˜¯å¹³æ—¶ä¸ç”¨çš„æ–¹æ³•ä¹Ÿä¼šåœ¨é‡Œé¢ï¼Œå‡å¦‚æ¯æ¬¡è¿è¡Œä¸€ä¸ªæ–¹æ³•ï¼Œéƒ½è¦å»<code>methodLists</code>éå†å¾—åˆ°æ–¹æ³•ï¼Œè¿™æ ·åŠ¿å¿…ä¼šå½±å“ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥<code>cache</code>åœ¨è¿™æ—¶å€™å°±ä¼šè¢«ç”¨ä¸Šï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç±»çš„æ–¹æ³•æ—¶å…ˆåˆ¤æ–­<code>cache</code>æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºæ—¶ä»<code>methodLists</code>æ‰¾åˆ°æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¿å­˜åˆ°<code>cache</code>ä¸­ï¼Œä¸ä¸ºç©ºæ—¶å…ˆä»<code>cache</code>ä¸­æ‰¾æ–¹æ³•ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†å»<code>methodLists</code>ä¸­æŸ¥æ‰¾ï¼Œè¿™æ ·æé«˜äº†ç¨‹åºæ–¹æ³•çš„è¿è¡Œæ•ˆç‡ã€‚</li>
<li><strong>protocols</strong> è¯¥ç±»éµä»çš„æ‰€æœ‰åè®®çš„åˆ—è¡¨ï¼Œä½¿ç”¨åœºæ™¯ï¼šåˆ¤æ–­ç±»æ˜¯å¦éµå®ˆäº†æŸä¸ªåè®®ã€‚</li>
<li><strong>class_rw_t</strong> é‡Œé¢çš„methodsã€propertiesã€protocolsæ˜¯äºŒç»´æ•°ç»„ï¼Œæ˜¯å¯è¯»å¯å†™çš„ï¼ŒåŒ…å«äº†<strong>ç±»</strong>çš„åˆå§‹å†…å®¹ã€<strong>åˆ†ç±»</strong>çš„å†…å®¹ã€‚</li>
<li><strong>class_ro_t</strong> é‡Œé¢çš„baseMethodListã€baseProtocolsã€ivarsã€basePropertiesæ˜¯ä¸€ç»´æ•°ç»„ï¼Œæ˜¯åªè¯»çš„ï¼ŒåŒ…å«äº†<strong>ç±»</strong>çš„åˆå§‹å†…å®¹ã€‚</li>
</ul>
<h2 id="meta-class-çš„ç»“æ„"><a href="#meta-class-çš„ç»“æ„" class="headerlink" title="meta-class çš„ç»“æ„"></a>meta-class çš„ç»“æ„</h2><p>meta-classæ˜¯classå¯¹è±¡çš„ç±»ï¼Œæ¯ä¸ªclasså¯¹è±¡éƒ½æœ‰è‡ªå·±çš„meta-classï¼Œæ¯ä¸ªç±»åœ¨å†…å­˜ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªmeta-classå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æŸä¸ªç±»ä¼ å…¥<code>object_getClass()</code>æ¥è·å–è¯¥ç±»çš„meta-classï¼Œè·å–åˆ°çš„è¿”å›ç±»å‹ä¾ç„¶æ˜¯Classç±»å‹ï¼Œè¯´æ˜meta-classä¹Ÿæ˜¯ä¸€ä¸ªobjc_classç»“æ„ç±»å‹ï¼Œmeta-classå¯¹è±¡å’Œclasså¯¹è±¡çš„å†…å­˜ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œmeta-classæ˜¯ä¸€ç§ç‰¹æ®Šçš„classï¼Œåœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>isa</strong> æŒ‡å‘åŸºç±»çš„meta-classã€‚</li>
<li><strong>superclass</strong> æŒ‡å‘meta-classçˆ¶ç±»ã€‚</li>
<li><strong>methodLists / methods</strong> å­˜å‚¨è¯¥ç±»ä¸­çš„ç±»æ–¹æ³•ä¿¡æ¯åˆ—è¡¨ï¼Œç±»ä¸­æ‰€æœ‰ç±»æ–¹æ³•çš„åˆ—è¡¨ã€‚</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h5 id="instanceå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬"><a href="#instanceå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬" class="headerlink" title="instanceå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬"></a>instanceå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬</h5><ol>
<li>isaæŒ‡é’ˆ</li>
<li>å…¶ä»–æˆå‘˜å˜é‡çš„å…·ä½“å€¼</li>
</ol>
<h5 id="classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬"><a href="#classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬" class="headerlink" title="classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬"></a>classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬</h5><ol>
<li>isaæŒ‡é’ˆ</li>
<li>superclassæŒ‡é’ˆ</li>
<li>ç±»çš„å±æ€§ä¿¡æ¯ï¼ˆ@propertyï¼‰ï¼Œç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼ˆivarï¼‰</li>
<li>ç±»çš„å¯¹è±¡æ–¹æ³•ä¿¡æ¯ï¼ˆinstance methodï¼‰ï¼Œç±»çš„åè®®ä¿¡æ¯ï¼ˆprotocolï¼‰</li>
</ol>
<h5 id="meta-classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬"><a href="#meta-classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬" class="headerlink" title="meta-classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬"></a>meta-classå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬</h5><ol>
<li>isaæŒ‡é’ˆ</li>
<li>superclassæŒ‡é’ˆ</li>
<li>ç±»çš„ç±»æ–¹æ³•çš„ä¿¡æ¯ï¼ˆclass methodï¼‰</li>
</ol>
<h5 id="è¿™äº›ä¿¡æ¯ä¸­çš„isaæŒ‡é’ˆå’ŒsuperclassæŒ‡é’ˆæ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œä¸‰ç§å¯¹è±¡é€šè¿‡è¿™ä¸¤ç§æŒ‡é’ˆæ¥äº’ç›¸æŸ¥æ‰¾è®¿é—®ï¼Œå…·ä½“çš„å…³ç³»å¯ä»¥ç”¨è¿™å¼ å›¾è¡¨ç¤º"><a href="#è¿™äº›ä¿¡æ¯ä¸­çš„isaæŒ‡é’ˆå’ŒsuperclassæŒ‡é’ˆæ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œä¸‰ç§å¯¹è±¡é€šè¿‡è¿™ä¸¤ç§æŒ‡é’ˆæ¥äº’ç›¸æŸ¥æ‰¾è®¿é—®ï¼Œå…·ä½“çš„å…³ç³»å¯ä»¥ç”¨è¿™å¼ å›¾è¡¨ç¤º" class="headerlink" title="è¿™äº›ä¿¡æ¯ä¸­çš„isaæŒ‡é’ˆå’ŒsuperclassæŒ‡é’ˆæ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œä¸‰ç§å¯¹è±¡é€šè¿‡è¿™ä¸¤ç§æŒ‡é’ˆæ¥äº’ç›¸æŸ¥æ‰¾è®¿é—®ï¼Œå…·ä½“çš„å…³ç³»å¯ä»¥ç”¨è¿™å¼ å›¾è¡¨ç¤º"></a>è¿™äº›ä¿¡æ¯ä¸­çš„isaæŒ‡é’ˆå’ŒsuperclassæŒ‡é’ˆæ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œä¸‰ç§å¯¹è±¡é€šè¿‡è¿™ä¸¤ç§æŒ‡é’ˆæ¥äº’ç›¸æŸ¥æ‰¾è®¿é—®ï¼Œå…·ä½“çš„å…³ç³»å¯ä»¥ç”¨è¿™å¼ å›¾è¡¨ç¤º</h5><p><img src="/CXTretar/CXTretar.github.io/2020/03/02/runtime-zhi-shi-dian-yi/1583162471214.jpg" alt="1583162471214"></p>
<h5 id="isaæŒ‡é’ˆçš„è½¨è¿¹"><a href="#isaæŒ‡é’ˆçš„è½¨è¿¹" class="headerlink" title="isaæŒ‡é’ˆçš„è½¨è¿¹"></a>isaæŒ‡é’ˆçš„è½¨è¿¹</h5><ul>
<li>instanceå¯¹è±¡çš„isaæŒ‡å‘class</li>
<li>classå¯¹è±¡çš„isaæŒ‡å‘meta-class</li>
<li>meta-classçš„isaç›´æ¥æŒ‡å‘åŸºç±»çš„meta-class (åˆ’é‡ç‚¹)</li>
</ul>
<h5 id="superClassæŒ‡é’ˆçš„è½¨è¿¹"><a href="#superClassæŒ‡é’ˆçš„è½¨è¿¹" class="headerlink" title="superClassæŒ‡é’ˆçš„è½¨è¿¹"></a>superClassæŒ‡é’ˆçš„è½¨è¿¹</h5><ul>
<li>classå¯¹è±¡çš„superclassæŒ‡å‘å…¶çˆ¶ç±»çš„classå¯¹è±¡ï¼Œå¦‚æœæ˜¯åŸºç±»çš„classå¯¹è±¡ï¼Œåˆ™å…¶superclassæŒ‡å‘nil</li>
<li>meta-classå¯¹è±¡çš„superclassæŒ‡å‘çˆ¶ç±»çš„meta-classå¯¹è±¡ï¼Œå¦‚æœæ˜¯åŸºç±»çš„meta-classå¯¹è±¡ï¼Œåˆ™å…¶superclassæŒ‡å‘åŸºç±»çš„classå¯¹è±¡ (åˆ’é‡ç‚¹)</li>
</ul>
<h5 id="å¯¹è±¡æ–¹æ³•å’Œç±»æ–¹æ³•çš„è°ƒç”¨"><a href="#å¯¹è±¡æ–¹æ³•å’Œç±»æ–¹æ³•çš„è°ƒç”¨" class="headerlink" title="å¯¹è±¡æ–¹æ³•å’Œç±»æ–¹æ³•çš„è°ƒç”¨"></a>å¯¹è±¡æ–¹æ³•å’Œç±»æ–¹æ³•çš„è°ƒç”¨</h5><ul>
<li>instanceè°ƒç”¨å¯¹è±¡æ–¹æ³•æ—¶ï¼Œå…ˆé€šè¿‡isaæ‰¾åˆ°è¯¥instanceçš„classä¸­æŸ¥æ‰¾å¯¹è±¡æ–¹æ³•ä¿¡æ¯ï¼Œå½“å‰classä¸­å¯¹è±¡æ–¹æ³•ä¸å­˜åœ¨æ—¶ï¼Œé€šè¿‡superClassæ‰¾åˆ°çˆ¶ç±»classå†è¿›è¡Œå¯¹è±¡æ–¹æ³•æŸ¥æ‰¾ï¼Œç›´åˆ°superClassæŒ‡å‘nilã€‚</li>
<li>classè°ƒç”¨ç±»æ–¹æ³•æ—¶ï¼Œå…ˆé€šè¿‡isaæ‰¾åˆ°è¯¥classçš„meta-classä¸­æŸ¥æ‰¾ç±»æ–¹æ³•ä¿¡æ¯ï¼Œå½“å‰meta-classä¸­ç±»æ–¹æ³•ä¸å­˜åœ¨æ—¶ï¼Œé€šè¿‡superClassæ‰¾åˆ°çˆ¶ç±»meta-classå†è¿›è¡Œå¯¹è±¡æ–¹æ³•æŸ¥æ‰¾ï¼Œç›´åˆ°superClassæŒ‡å‘nilã€‚</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆå‘˜å˜é‡å’Œå±æ€§çš„åŒºåˆ«</title>
    <url>/2020/03/04/cheng-yuan-bian-liang-he-shu-xing-de-qu-bie/</url>
    <content><![CDATA[<h3 id="æˆå‘˜å˜é‡çš„ä½¿ç”¨"><a href="#æˆå‘˜å˜é‡çš„ä½¿ç”¨" class="headerlink" title="æˆå‘˜å˜é‡çš„ä½¿ç”¨"></a>æˆå‘˜å˜é‡çš„ä½¿ç”¨</h3><p>æˆå‘˜å˜é‡æ˜¯å£°æ˜åœ¨ç±»{}ä¸­çš„ï¼Œåœ¨ç±»çš„.h å¤´æ–‡ä»¶å’Œç±»çš„çš„.m æ–‡ä»¶ç±»æ‰©å±•éƒ½å¯ä»¥å¯¹æˆå‘˜å˜é‡è¿›è¡Œå£°æ˜ã€‚</p>
<h5 id="h-æ–‡ä»¶ä¸­å£°æ˜"><a href="#h-æ–‡ä»¶ä¸­å£°æ˜" class="headerlink" title=".h æ–‡ä»¶ä¸­å£°æ˜"></a>.h æ–‡ä»¶ä¸­å£°æ˜</h5><pre class=" language-objectivec"><code class="language-objectivec"><span class="token keyword">@interface</span> Person <span class="token punctuation">:</span> NSObject <span class="token punctuation">{</span>
    <span class="token keyword">int</span> _phone<span class="token punctuation">;</span>
    NSString <span class="token operator">*</span>_nickname<span class="token punctuation">;</span>

<span class="token keyword">@public</span>
    NSString <span class="token operator">*</span>_publicString<span class="token punctuation">;</span>

<span class="token keyword">@protected</span>
    NSString <span class="token operator">*</span>_protectedString<span class="token punctuation">;</span>

<span class="token keyword">@private</span>
    NSString <span class="token operator">*</span>_privateString<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>
</code></pre>
<h5 id="m-æ–‡ä»¶ç±»æ‰©å±•ä¸­å£°æ˜"><a href="#m-æ–‡ä»¶ç±»æ‰©å±•ä¸­å£°æ˜" class="headerlink" title=".m æ–‡ä»¶ç±»æ‰©å±•ä¸­å£°æ˜"></a>.m æ–‡ä»¶ç±»æ‰©å±•ä¸­å£°æ˜</h5><pre class=" language-objectivec"><code class="language-objectivec"><span class="token macro property">#<span class="token directive keyword">import</span> "Person.h"</span>

<span class="token keyword">@interface</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> _phoneNum<span class="token punctuation">;</span>
    NSString <span class="token operator">*</span>_address<span class="token punctuation">;</span>

<span class="token keyword">@public</span>
    <span class="token keyword">int</span> _age<span class="token punctuation">;</span>
    NSString <span class="token operator">*</span>_extensionString<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>

<span class="token keyword">@implementation</span> Person

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>init <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> init<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token operator">-></span>_extensionString <span class="token operator">=</span> <span class="token string">@"extensionString"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>

</code></pre>
<p>åœ¨è¿™é‡Œå¯¹æˆå‘˜å˜é‡æœ‰<code>@privateã€@protectedã€@public</code>ä¸‰ç§ä¿®é¥°ç¬¦ï¼š</p>
<ul>
<li><strong>@private</strong> ç§æœ‰çš„ï¼Œåªèƒ½åœ¨æœ¬ç±»è®¿é—®</li>
<li><strong>@protected</strong> å—ä¿æŠ¤çš„ï¼Œåªèƒ½åœ¨æœ¬ç±»åŠå…¶å­ç±»å†…éƒ¨ä¸­è®¿é—®ï¼Œåœ¨{}å£°æ˜çš„å˜é‡é»˜è®¤æ˜¯<strong>@protected</strong></li>
<li><strong>@public </strong>å…¬å¼€çš„ï¼Œå¯ä»¥è¢«åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚</li>
</ul>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨.h æ–‡ä»¶ä¸­å¯¹æˆå‘˜å˜é‡ä½¿ç”¨ä¿®é¥°ç¬¦æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œåœ¨.m æ–‡ä»¶ç±»æ‰©å±•éƒ½æˆå‘˜å˜é‡æ— è®ºç”¨ä½•ç§ä¿®é¥°éƒ½æ˜¯privateï¼Œåªèƒ½åœ¨è‡ªå·±çš„ç±»å†…éƒ¨è®¿é—®ã€‚ä¾‹å¦‚ä¸€ä¸ªStudentç±»ç»§æ‰¿äºPersonï¼Œåœ¨å…¶å†…éƒ¨èƒ½å¤Ÿè¯»å–Personç±»å¤´æ–‡ä»¶ä¸­é™¤äº†privateä¹‹å¤–çš„å…¶ä»–æˆå‘˜å˜é‡ï¼Œ å´ä¸èƒ½è¯»å–åˆ°Personç±»æ‰©å±•ä¸­å®šä¹‰çš„æˆå‘˜å˜é‡ã€‚</strong></p>
<p><img src="/CXTretar/CXTretar.github.io/2020/03/04/cheng-yuan-bian-liang-he-shu-xing-de-qu-bie/20200304195639862.png" alt="20200304195639862"></p>
<h3 id="å±æ€§çš„ä½¿ç”¨"><a href="#å±æ€§çš„ä½¿ç”¨" class="headerlink" title="å±æ€§çš„ä½¿ç”¨"></a>å±æ€§çš„ä½¿ç”¨</h3><p>åœ¨iOS 5.0ä¹‹å‰ï¼Œå±æ€§å£°æ˜æ˜¯ocè¯­è¨€çš„ä¸€ä¸ªæ–°çš„æœºåˆ¶ï¼Œåœ¨å£°æ˜æ—¶è¦æ±‚å¿…é¡»å£°æ˜ä¸ä¹‹å¯¹åº”çš„æˆå‘˜å˜é‡ã€‚å±æ€§çš„æ­£å¸¸å†™æ³•éœ€è¦1.å£°æ˜æˆå‘˜å˜é‡ï¼Œ 2.<strong>@property</strong> ï¼Œ3. <strong>@synthesize</strong> æˆå‘˜å˜é‡ä¸‰ä¸ªæ­¥éª¤ï¼Œä¾‹å¦‚<strong>name</strong>å±æ€§çš„å£°æ˜ï¼š</p>
<pre class=" language-objectivec"><code class="language-objectivec"><span class="token macro property">#<span class="token directive keyword">import</span> "Person1.h"</span>

<span class="token keyword">@interface</span> <span class="token function">Person1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1.å£°æ˜æˆå‘˜å˜é‡</span>
     NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// 2.å£°æ˜å±æ€§</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>

<span class="token keyword">@end</span>

<span class="token keyword">@implementation</span> Person1

<span class="token comment" spellcheck="true">// 3.æœ€ååœ¨@implementationä¸­ç”¨synthesizeç”Ÿæˆsetteræ–¹æ³•</span>
<span class="token keyword">@synthesize</span> name<span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>init <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> init<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">@"Jack"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>

</code></pre>
<p>åœ¨iOS 5.0ä¹‹åï¼Œè‹¹æœæ¨å‡ºä¸€ä¸ªæ–°æœºåˆ¶ï¼Œ<strong>@property</strong>å£°æ˜çš„å±æ€§é»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ª  <strong>_</strong>   ç±»å‹çš„æˆå‘˜å˜é‡ï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆ<strong>setter/getter</strong>æ–¹æ³•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç°è¡Œçš„å±æ€§å£°æ˜æ–¹å¼ï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•æ¥ä»£æ›¿<strong>setter/getter</strong>æ–¹æ³•è®¿é—®å±æ€§ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šé¢ä»£ç ä¸­å‡ºç°äº†<strong>@synthesize</strong>è¿™æ ·ä¸€ä¸ªå…³é”®å­—ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯<strong>@dynamic</strong>ã€‚</p>
<ul>
<li><strong>synthesize</strong> ä¸ºç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆè®¿é—®å±æ€§çš„<strong>setter/getter</strong>æ–¹æ³•ã€‚å‡å¦‚æˆ‘ä»¬åœ¨iOS 5.0ä¹‹åä¾ç„¶åœ¨<strong>@implementation</strong> æ–‡ä»¶ä¸­å†™äº† <strong>@synthesize name</strong> ï¼Œé‚£ä¹ˆç”Ÿæˆå¯¹åº”çš„æˆå‘˜å˜é‡åä¾¿æ˜¯<strong>name</strong>ï¼Œè€Œä¸æ˜¯<strong>_name</strong>ã€‚</li>
<li><strong>dynamic</strong> ä¸ºç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ™ä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå±æ€§çš„<strong>setter</strong>ä¸<strong>getter</strong>æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆï¼ˆå½“ç„¶å¯¹äº<strong>readonly</strong>çš„å±æ€§åªéœ€æä¾›<strong>getter</strong>å³å¯ï¼‰ã€‚</li>
</ul>
<pre class=" language-objectivec"><code class="language-objectivec"><span class="token macro property">#<span class="token directive keyword">import</span> "Person2.h"</span>

<span class="token keyword">@interface</span> <span class="token function">Person2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSString <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSString <span class="token operator">*</span>address<span class="token punctuation">;</span>
<span class="token keyword">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> copy<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> NSString <span class="token operator">*</span>nickName<span class="token punctuation">;</span>

<span class="token keyword">@end</span>


<span class="token keyword">@implementation</span> Person2

<span class="token keyword">@synthesize</span> name<span class="token punctuation">;</span>
<span class="token keyword">@dynamic</span> address<span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>init <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> init<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">@"Jack"</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> setValue<span class="token punctuation">:</span><span class="token string">@"nickName"</span> forKey<span class="token punctuation">:</span><span class="token string">@"nickName"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token string">@"Xiamen"</span><span class="token punctuation">;</span>

        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"name: %@"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"nickName: %@"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>nickName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"address: %@"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>
</code></pre>
<p>ä¾‹å¦‚è¿è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šæç¤ºè¿™æ ·çš„é”™è¯¯ï¼Œè¯´æ˜æ‰¾ä¸åˆ°<strong>address</strong>å±æ€§çš„<strong>setter</strong>æ–¹æ³•ï¼Œå½“ç„¶<strong>getter</strong>æ–¹æ³•ä¹Ÿæ˜¯æ‰¾ä¸åˆ°çš„ã€‚</p>
<blockquote>
<p><strong>Terminating app due to uncaught exception â€˜NSInvalidArgumentExceptionâ€™, reason: â€˜-[Person2 setAddress:]: unrecognized selector sent to instance 0x600001a2b140â€™</strong></p>
</blockquote>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li><strong>æ ¹æ®æˆå‘˜å˜é‡çš„ç§æœ‰æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›æ— éœ€ä¸å¤–ç•Œæ¥è§¦çš„å˜é‡ç”¨æˆå‘˜å˜é‡çš„å½¢å¼å£°æ˜ï¼Œè€Œé‚£äº›æä¾›ç»™å¤–ç•Œè®¿é—®çš„å˜é‡ï¼Œæˆ‘ä»¬å¯ç›´æ¥ç”¨å±æ€§çš„å½¢å¼æ¥å£°æ˜ã€‚</strong></li>
<li><strong>æˆå‘˜å˜é‡çš„å£°æ˜ä¸ä¼šç”Ÿæˆsetter/getteræ–¹æ³•ï¼Œåœ¨ä½¿ç”¨æ—¶åˆ™éœ€é€šè¿‡-&gt;çš„æ–¹å¼è®¿é—®ã€‚</strong></li>
<li><strong>æˆå‘˜å˜é‡è¿˜å¯ä»¥é€šè¿‡@privateã€@protectedã€@publicæ¥æä¾›ä¸åŒçš„è®¿é—®æƒé™ã€‚</strong></li>
<li><strong>å±æ€§å¯¹æˆå‘˜å˜é‡æ‰©å……äº†setter/getteræ–¹æ³•ï¼Œå±æ€§é»˜è®¤ä¼šç”Ÿæˆå¸¦ä¸‹åˆ’çº¿çš„æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç‚¹è¯­æ³•æ¥å¾ˆæ–¹ä¾¿çš„å¯¹æˆå‘˜å˜é‡çš„è®¿é—®ã€‚</strong></li>
<li><strong>å±æ€§å¯ä»¥é€šè¿‡@synthesizeæˆ–è€…@dynamicæ¥å†³å®šæ˜¯å¦è‡ªåŠ¨ç”Ÿæˆsetter/getteræ–¹æ³•ï¼Œ@synthesizeä¸ºè‡ªåŠ¨ç”Ÿæˆï¼Œ @dynamicä¸ºä¸è‡ªåŠ¨ç”Ÿæˆã€‚</strong></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯ - iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>iOSç»„ä»¶åŒ–-æäº¤ç»„ä»¶ä»£ç åˆ°cocoapodsä½œä¸ºæ¡†æ¶</title>
    <url>/2018/06/28/ios-zu-jian-hua-ti-jiao-zu-jian-dai-ma-dao-cocoapods-zuo-wei-kuang-jia-shi-yong/</url>
    <content><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>ä½¿ç”¨CocoaPodséå¸¸é«˜æ•ˆåœ°å°†ä¸€äº›ç¬¬ä¸‰æ–¹ç±»åº“å¯¼å…¥åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ï¼Œä½œä¸ºä¸€ä¸ªiOSå¼€å‘è€…ï¼Œå¤§å®¶è‚¯å®šæœ‰è‡ªå·±å°è£…çš„ä¸€äº›å°ç»„ä»¶ï¼Œå‡å¦‚èƒ½è®©è‡ªå·±å°è£…çš„ç»„ä»¶æ”¯æŒpodé›†æˆï¼Œå°±èƒ½æä¾›ç»™å…¶ä»–å¼€å‘è€…ä½¿ç”¨ï¼Œå²‚ä¸ç¾å“‰ã€‚æ¥ä¸‹æ¥å°†ç”¨ä¸€ä¸ªDemoæ¥æ¼”ç¤ºç»„ä»¶åŒ–æ“ä½œæµç¨‹ä»¥åŠæ³¨æ„äº‹é¡¹ã€‚</p>
<h2 id="æ“ä½œæµç¨‹"><a href="#æ“ä½œæµç¨‹" class="headerlink" title="æ“ä½œæµç¨‹"></a>æ“ä½œæµç¨‹</h2><h3 id="1-ä¸Šä¼ é¡¹ç›®æºç "><a href="#1-ä¸Šä¼ é¡¹ç›®æºç " class="headerlink" title="1.ä¸Šä¼ é¡¹ç›®æºç "></a>1.ä¸Šä¼ é¡¹ç›®æºç </h3><p>åœ¨githubä¸Šåˆ›å»ºä»“åº“çš„æµç¨‹æˆ‘å°±ä¸ç´¯è¿°äº†ï¼Œé¦–å…ˆæŠŠé¡¹ç›®æºç ä¸Šä¼ åˆ°githubä»“åº“å†cloneåˆ°æœ¬åœ°ï¼Œå¦‚æœé¡¹ç›®æœ¬æ¥å°±åœ¨githubçš„ä»“åº“ä¸­ï¼Œç›´æ¥cloneåˆ°æœ¬åœ°å³å¯ï¼Œè¿™é‡Œä»¥CXDatePickerViewä¸ºä¾‹ï¼Œ<a href="https://github.com/CXTretar/CXDatePickerView">Demoé¡¹ç›®åœ°å€</a>ã€‚</p>
<h3 id="2-åˆ›å»ºé¡¹ç›®çš„podspecæ–‡ä»¶"><a href="#2-åˆ›å»ºé¡¹ç›®çš„podspecæ–‡ä»¶" class="headerlink" title="2.åˆ›å»ºé¡¹ç›®çš„podspecæ–‡ä»¶"></a>2.åˆ›å»ºé¡¹ç›®çš„podspecæ–‡ä»¶</h3><p>ç”¨ç»ˆç«¯å‘½ä»¤cdæ‰“å¼€æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹å¹¶æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:<br><code>$ pod spec create CXDatePickerView</code><br>è¿™æ—¶å€™æ–‡ä»¶å¤¹ä¸­å°±ç”Ÿæˆä¸€ä¸ªCXDatePickerView.podspecæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ç”¨xcodeæ‰“å¼€ã€‚<br>ç»ˆç«¯å‘½ä»¤:<br><code>open -a Xcode CXDatePickerView.podspec</code><br>åˆšç”Ÿæˆçš„æ–‡ä»¶æœ‰å¾ˆå¤šä¸å¿…è¦çš„æ³¨é‡Šï¼Œå¯ä»¥åˆ é™¤ï¼Œéœ€è¦ä¿ç•™çš„é…ç½®å­—æ®µï¼Œå¯ä»¥æŸ¥çœ‹<a href="http://guides.cocoapods.org/syntax/podspec.html" target="_blank" rel="noopener">http://guides.cocoapods.org/syntax/podspec.html</a>ã€‚<br>Demoä¸­ä¿ç•™äº†ä»¥ä¸‹å­—æ®µï¼š</p>
<pre><code>Pod::Spec.new do |s|

  s.name         = "CXDatePickerView"   //  åç§°
  s.version      = "0.1.1"              //  ç‰ˆæœ¬å·
  s.summary      = "CXDatePickerView"   //  ç®€è¦è¯´æ˜

  s.description  = &lt;&lt;-DESC
                   This is a custom date picker view that provides a number of modifiable UI interfaces.
                   DESC                 //  åŠŸèƒ½æè¿°

  s.homepage     = "https://github.com/CXTretar/CXDatePickerView" //é¡¹ç›®ä¸»é¡µ
  s.license      = "MIT"                //  è®¸å¯è¯

  s.author       = { "CXTretar" =&gt; "misscxuan@163.com" } //  æ‰€æœ‰è€…

  s.platform     = :ios, "8.0"          //  ç³»ç»Ÿç‰ˆæœ¬

  s.source       = { :git =&gt; "https://github.com/CXTretar/CXDatePickerView.git", :tag =&gt; s.version.to_s } //  é¡¹ç›®æºåœ°å€

  s.source_files  = "CXDatePickerView/CXDatePickerView/*.{h,m}" // å…³è”çš„æºæ–‡ä»¶

  s.requires_arc = true                 // æ˜¯å¦æ”¯æŒARC

end
</code></pre><p>åœ¨è¿™äº›å­—æ®µä¸­ <code>s.platform</code> å’Œ <code>s.source_files</code> éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚<br><code>s.platform</code> ç³»ç»Ÿç‰ˆæœ¬ä¸è¦å†™çš„å¤ªä½ï¼Œä¸ç„¶ä¸Šä¼ åˆ°cocoapodsæ—¶ä¼šå› ä¸ºä¸æ”¯æŒMRCè€Œå‡ºç°ä¸€äº›ä¸å¿…è¦çš„è­¦å‘Šï¼Œåœ¨ä½¿ç”¨æ—¶ä¹Ÿä¼šå‡ºç°å¤šä½™çš„è­¦å‘Šï¼Œå»ºè®®å¡«å†™â€8.0â€ã€‚<br><code>s.source_files</code> æ˜¯ä½ è¦ä¸Šä¼ çš„ç»„ä»¶æ–‡ä»¶å¤¹åœ°å€ï¼Œä¸€å®šè¦æ˜¯æ­£ç¡®çš„è·¯å¾„ï¼Œä¸ç„¶åœ¨ä¸Šä¼ åˆ°cocoapodsæ—¶ä¼šå‡ºç°<code>[iOS] file patterns: The 'source_files' pattern did not match any file.</code>é”™è¯¯ã€‚å¡«å†™çš„è·¯å¾„æ ¼å¼ä¸º <code>é¡¹ç›®æ–‡ä»¶å¤¹name/ç»„ä»¶æ–‡ä»¶å¤¹name/*.{h,m}</code>ï¼Œå‡å¦‚ç»„ä»¶æ–‡ä»¶å¤¹ä¸­è¿˜æœ‰å…¶ä»–æ–‡ä»¶å¤¹ï¼Œåˆ™ä¸º <code>é¡¹ç›®æ–‡ä»¶å¤¹name/ç»„ä»¶æ–‡ä»¶å¤¹name/**/*.{h,m}</code>ã€‚</p>
<h3 id="3-éªŒè¯podspecæ–‡ä»¶"><a href="#3-éªŒè¯podspecæ–‡ä»¶" class="headerlink" title="3.éªŒè¯podspecæ–‡ä»¶"></a>3.éªŒè¯podspecæ–‡ä»¶</h3><p>ç¼–è¾‘å®Œpodspecæ–‡ä»¶åéœ€è¦éªŒè¯è¯¥æ–‡ä»¶æ˜¯å¦å¯ç”¨ï¼Œpodspecæ–‡ä»¶ä¸å…è®¸æœ‰ä»»ä½•çš„Warningæˆ–è€…Error<br>ç»ˆç«¯å‘½ä»¤:<br><code>$ pod lib lint</code><br>å¦‚æœå‡ºç°</p>
<pre><code>-&gt; CXDatePickerView (0.0.1)

CXDatePickerView passed validation.
</code></pre><p>åˆ™è¯´æ˜éªŒè¯é€šè¿‡ï¼Œå¦åˆ™ï¼Œå°±éœ€è¦æ ¹æ®æç¤ºä¿®æ”¹podspecæ–‡ä»¶å†æ¬¡éªŒè¯ç›´åˆ°éªŒè¯é€šè¿‡ã€‚<br>å› ä¸ºXcodeå…è®¸è­¦å‘Šå­˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å‘½ä»¤å±è”½è­¦å‘Š<br><code>$ pod lib lint --allow-warnings</code><br>å¦‚æœå‡ºç°Errorä½†æ˜¯æç¤ºä¿¡æ¯ä¸è¶³ï¼Œå¯ä»¥æ·»åŠ â€“verbose ä»¥è·å–æ›´å¤šé”™è¯¯ä¿¡æ¯<br><code>$ pod lib lint --verbose</code></p>
<h3 id="4-ä¸Šä¼ podspecæ–‡ä»¶"><a href="#4-ä¸Šä¼ podspecæ–‡ä»¶" class="headerlink" title="4.ä¸Šä¼ podspecæ–‡ä»¶"></a>4.ä¸Šä¼ podspecæ–‡ä»¶</h3><p>podspecæ–‡ä»¶ä¸­éœ€è¦æŒ‡å®šçš„tagï¼Œå®Œæˆä¸Šè¿°æ“ä½œåç»™é¡¹ç›®æ‰“tag</p>
<pre><code>$ git tag -m"release CXDatePickerView with podspec" "0.0.1"
$ git push --tags
</code></pre><p>æ¥ä¸‹æ¥å°±éœ€è¦å°†podspecæ–‡ä»¶ä¸Šä¼ è‡³CocoaPodå®˜æ–¹åº“ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ° pod trunk è´¦å·ï¼Œç›¸ä¿¡å¾ˆå¤šäººéƒ½è¿˜æ²¡æœ‰æ³¨å†Œè¿‡ã€‚è¿™é‡Œç®€è¦è¯´æ˜ä¸€ä¸‹æ³¨å†Œæµç¨‹ï¼š</p>
<h5 id="â‘ -ç»ˆç«¯æ³¨å†Œtrunkè´¦å·"><a href="#â‘ -ç»ˆç«¯æ³¨å†Œtrunkè´¦å·" class="headerlink" title="â‘ .ç»ˆç«¯æ³¨å†Œtrunkè´¦å·"></a>â‘ .ç»ˆç«¯æ³¨å†Œtrunkè´¦å·</h5><p><code>$ pod trunk register 'é‚®ç®±' 'ç”¨æˆ·å' --description='ç”µè„‘æè¿°'</code><br>ä¾‹å¦‚<br><code>$ pod trunk register 'misscxuan@163.com' 'CXTretar' --description='macbook pro'</code><br>æ³¨å†ŒæˆåŠŸçš„è¯ä¼šå›å¤<br><code>[!] Please verify the session by clicking the link in the verification email that has been sent to misscxuan@163.com</code></p>
<h5 id="â‘¡-æŸ¥æ”¶é‚®ä»¶"><a href="#â‘¡-æŸ¥æ”¶é‚®ä»¶" class="headerlink" title="â‘¡.æŸ¥æ”¶é‚®ä»¶"></a>â‘¡.æŸ¥æ”¶é‚®ä»¶</h5><p>å¦‚æœæ˜¯QQé‚®ç®±ï¼Œå¯èƒ½ä¼šè¢«æ”¾åˆ°â€œåƒåœ¾ç®±â€ä¸­ï¼Œå¹¶ä¸ä¸€å®šæ˜¯â€œæ”¶ä»¶ç®±â€ã€‚<br>ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥ï¼š<br><code>https://trunk.cocoapods.org/sessions/verify/xxxx</code></p>
<h5 id="â‘¢-æ¥ä¸‹æ¥æŸ¥çœ‹ä¸ªäººä¿¡æ¯"><a href="#â‘¢-æ¥ä¸‹æ¥æŸ¥çœ‹ä¸ªäººä¿¡æ¯" class="headerlink" title="â‘¢.æ¥ä¸‹æ¥æŸ¥çœ‹ä¸ªäººä¿¡æ¯"></a>â‘¢.æ¥ä¸‹æ¥æŸ¥çœ‹ä¸ªäººä¿¡æ¯</h5><p><code>$ pod trunk me</code><br>ç»“æœä¿¡æ¯ï¼š</p>
<pre><code>  - Name:     CXTretar
  - Email:    misscxuan@163.com
  - Since:    June 27th, 01:08
  - Pods:
    - CXDatePickerView
  - Sessions:
    - June 27th, 01:08 - November 3rd, 01:09. IP: xxx.xxx.xxx.xxx
    Description: macbook pro
</code></pre><p>åˆ°è¿™ä¸€æ­¥å°±æ³¨å†ŒæˆåŠŸäº†ï¼Œå‡å¦‚é‡åˆ° <code>NoMethodError - undefined method 'last' for #&lt;Netrc::Entry:0x007fc59c246378&gt;</code> è¿™æ ·çš„é—®é¢˜éœ€è¦å°è¯•æ›´æ–°gemæºæˆ–è€…podï¼š</p>
<pre><code>$ sudo gem update --system
$ sudo gem install cocoapods
$ sudo gem install cocospods-trunk
</code></pre><p>å¦‚æœé‡åˆ° <code>[!] Authentication token is invalid or unverified. Either verify it with the email that was sent or register a new session.</code> è¯·é‡æ–°å†æ³¨å†Œä¸€æ¬¡ã€‚<br>pod trunk è®¾ç½®å®Œæ¯•åæ‰§è¡Œç»ˆç«¯å‘½ä»¤:<br><code>$ pod trunk push CXDatePickerView.podspec</code><br>å‘å¸ƒæ—¶å¯ä»¥å…è®¸è­¦å‘Šï¼š<br><code>$ pod trunk push --allow-warnings CXDatePickerView.podspec</code><br>è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ï¼Œå‡å¦‚æœ‰VPNå·¥å…·çš„è¯ï¼Œå»ºè®®å¼€å¯VPNåå†è¿›è¡Œè¿™ä¸€æ­¥ã€‚<br>æˆåŠŸæ—¶ä¼šæ˜¾ç¤º</p>
<pre><code>Updating spec repo `master`
Validating podspec
 -&gt; CXDatePickerView (0.0.1)

--------------------------------------------------------------------------------
 ğŸ‰  Congrats

 ğŸš€  CXDatePickerView (0.0.1) successfully published
 ğŸ“…  June 28th, 01:22
 ğŸŒ  https://cocoapods.org/pods/CXDatePickerView
 ğŸ‘  Tell your friends!
--------------------------------------------------------------------------------
</code></pre><h3 id="5-æœç´¢ç»„ä»¶æ¡†æ¶"><a href="#5-æœç´¢ç»„ä»¶æ¡†æ¶" class="headerlink" title="5.æœç´¢ç»„ä»¶æ¡†æ¶"></a>5.æœç´¢ç»„ä»¶æ¡†æ¶</h3><p>æ­¤æ—¶ä½ çš„ç»„ä»¶åº“å·²ç»ä¸Šä¼ è‡³cocoapodså®˜æ–¹åº“ä¸­ï¼Œå¯ä»¥è¿™æ ·å­æœç´¢</p>
<pre><code>$ pod setup 
$ pod repo update
$ pod search CXDatePickerView
</code></pre><p>å‡å¦‚æœç´¢ç»“æœä¸º <code>[!] Unable to find a pod with name, author, summary, or description matching 'xxxx'</code>ï¼Œè¯´æ˜ä½ çš„podæœç´¢åº“è¿˜æ²¡æœ‰æ›´æ–°ï¼Œè§£å†³æ–¹æ³•æ˜¯é€šè¿‡Finderå‰å¾€èµ„æºåº“å»åˆ é™¤ç¼“å­˜ä¸­çš„search_index.jsonï¼Œè·¯å¾„ä¸º<code>~/Library/Caches/CocoaPods</code>ï¼Œåˆ é™¤search_index.jsonï¼Œå†é‡æ–°è°ƒç”¨ <code>pod search CXDatePickerView</code> ä»£ç å°±èƒ½å¤Ÿæœç´¢åˆ°ä½ åˆšä¸Šä¼ çš„ç»„ä»¶åº“ã€‚</p>
<p>å®Œç»“æ•£èŠ±(<em>^â–½^</em>)ï¼Œå¸Œæœ›è¿™ç¯‡æ•™ç¨‹å¯¹ä½ æœ‰å¸®åŠ©ï¼</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ PaintCode ç»˜åˆ¶è‡ªå®šä¹‰çš„çœä»½åœ°å›¾æ§ä»¶</title>
    <url>/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/</url>
    <content><![CDATA[<p><a href="https://github.com/CXTretar/CXProvincesMapView">Demoé“¾æ¥</a></p>
<h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><h5 id="éœ€è¦ç”¨åˆ°çš„è½¯ä»¶-è§£å‹å¯†ç -xclient-info"><a href="#éœ€è¦ç”¨åˆ°çš„è½¯ä»¶-è§£å‹å¯†ç -xclient-info" class="headerlink" title="éœ€è¦ç”¨åˆ°çš„è½¯ä»¶ (è§£å‹å¯†ç  xclient.info)"></a>éœ€è¦ç”¨åˆ°çš„è½¯ä»¶ (è§£å‹å¯†ç  <strong>xclient.info</strong>)</h5><ul>
<li><p><a href="https://pan.baidu.com/s/1qSAeNTmj3e8Jfu2klvHnTg" target="_blank" rel="noopener">Sketch</a> </p>
<p>Sketch æ˜¯ä¸€æ¬¾Macä¸Šå°å·§ä½†åŠŸèƒ½å¼ºå¤§çš„çŸ¢é‡ç»˜å›¾è½¯ä»¶ï¼Œè¿™æ˜¯ä¸“ä¸ºè®¾è®¡å¸ˆè€Œæ‰“é€ çš„çŸ¢é‡ç»˜å›¾è½¯ä»¶ï¼Œæ‹¥æœ‰ç®€çº¦çš„è®¾è®¡ï¼Œè°ƒè‰²æ¿ï¼Œé¢æ¿ï¼Œèœå•ï¼Œçª—å£ï¼Œæ§ä»¶å’ŒåŠŸèƒ½å¼ºå¤§çš„çŸ¢é‡ç»˜å›¾å’Œæ–‡å­—å·¥å…·ï¼›åŒ…å«é’ˆå¯¹UIè®¾è®¡çš„æ“ä½œå’Œäº¤äº’æ¨¡å¼ï¼Œè®©ä½ è®¾è®¡å›¾æ ‡ã€ç§»åŠ¨æ‰‹æœºUIã€ç½‘ç«™UIç­‰æ›´åŠ ç®€å•é«˜æ•ˆã€‚</p>
</li>
<li><p><a href="https://pan.baidu.com/s/1FAjdUCrYVniNLksW3aY_8A" target="_blank" rel="noopener">PaintCode</a></p>
<p>PaintCode æ˜¯ä¸€æ¬¾ Mac ä¸Šçš„ iOS çŸ¢é‡ç»˜å›¾ç¼–ç¨‹è½¯ä»¶ï¼Œæ— è®ºæ˜¯ç¨‹åºå‘˜è¿˜æ˜¯è®¾è®¡å¸ˆï¼ŒPaintCode èƒ½å¤Ÿè®©ä½ åƒåœ¨PSä¸­ç”»å›¾ä¸€æ ·ç»˜åˆ¶å„ç§UIå›¾å½¢ï¼ŒPaintCode ä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆé’ˆå¯¹ Mac OS X æˆ– iOS å¹³å° Objective-C æˆ– C# ä»£ç ï¼Œèƒ½å¤ŸèŠ‚çº¦å¤§é‡çš„ç¼–ç¨‹æ—¶é—´ï¼Œæ”¯æŒå°†ä»£ç ç›´æ¥å¯¼å…¥åˆ° Xcode ä¸­æˆ–å¯¼å‡ºä¸º PSD æ–‡ä»¶ï¼Œæ”¯æŒæœ€æ–°çš„ iOS  å’Œ iWatch SDKï¼Œéå¸¸çš„å®ç”¨ï¼</p>
</li>
</ul>
<h5 id="åœ°å›¾-svg-æ–‡ä»¶çš„è·å–"><a href="#åœ°å›¾-svg-æ–‡ä»¶çš„è·å–" class="headerlink" title="åœ°å›¾ svg æ–‡ä»¶çš„è·å–"></a>åœ°å›¾ svg æ–‡ä»¶çš„è·å–</h5><p>æ¨èä½¿ç”¨ <a href="https://www.highcharts.com.cn/mapdata" target="_blank" rel="noopener">HighChart åœ°å›¾æ•°æ®</a>ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥è‡ªç”±çš„é€‰æ‹©å›½å†…çš„æŸä¸ªçœä»½åœ°å›¾ä¸‹è½½ç›¸åº”çš„ svg æ–‡ä»¶ï¼Œè¿™é‡Œé€‰æ‹©ç¦å»ºçœä½œä¸ºä¸€ä¸ªä¾‹å­ã€‚</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191027233307531.png" alt="image-20191027233307531"></p>
<h4 id="ä½¿ç”¨-Sketch-å¯¹ä¸‹è½½çš„-svg-æ–‡ä»¶è¿›è¡Œå†åŠ å·¥"><a href="#ä½¿ç”¨-Sketch-å¯¹ä¸‹è½½çš„-svg-æ–‡ä»¶è¿›è¡Œå†åŠ å·¥" class="headerlink" title="ä½¿ç”¨ Sketch å¯¹ä¸‹è½½çš„ svg æ–‡ä»¶è¿›è¡Œå†åŠ å·¥"></a>ä½¿ç”¨ Sketch å¯¹ä¸‹è½½çš„ svg æ–‡ä»¶è¿›è¡Œå†åŠ å·¥</h4><p>ç”±äºé€šè¿‡ HighChart åœ°å›¾æ•°æ®ä¸‹è½½çš„ svg æ–‡ä»¶æœ‰ä¸€äº› logo æ–‡å­—ä¿¡æ¯çš„éƒ¨åˆ†å›¾å±‚æ˜¯æˆ‘ä»¬å¼€å‘æ—¶ä¸éœ€è¦çš„ï¼Œè€Œä¸”ä¼šå¹²æ‰°åœ°å›¾çš„æ˜¾ç¤ºï¼Œæ‰€ä»¥ä½¿ç”¨ Sketch å»é™¤è¿™äº›éƒ¨åˆ†ã€‚</p>
<p>ä½¿ç”¨ Sketch æ‰“å¼€ä¸‹è½½çš„ svg æ–‡ä»¶ï¼Œå±è”½è¿™äº›æ— ç”¨çš„ä¿¡æ¯å›¾å±‚</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191027234921580.png" alt="image-20191027234921580"></p>
<p>é‡æ–°å¯¼å‡ºå¾—æ–° svg æ–‡ä»¶æ‰æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ç”¨åˆ°åœ°å›¾æ–‡ä»¶</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191027235144789.png" alt="image-20191027235144789"></p>
<h4 id="ä½¿ç”¨-PaintCode-æ ¹æ®-svg-æ–‡ä»¶ç”Ÿæˆ-Objective-C-ä»£ç "><a href="#ä½¿ç”¨-PaintCode-æ ¹æ®-svg-æ–‡ä»¶ç”Ÿæˆ-Objective-C-ä»£ç " class="headerlink" title="ä½¿ç”¨ PaintCode æ ¹æ® svg æ–‡ä»¶ç”Ÿæˆ Objective-C ä»£ç "></a>ä½¿ç”¨ PaintCode æ ¹æ® svg æ–‡ä»¶ç”Ÿæˆ Objective-C ä»£ç </h4><p>é€šè¿‡ PaintCode æ‰“å¼€ svg æ–‡ä»¶</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191028000249045.png" alt="image-20191028000419208"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° PaintCode å·²ç»è‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆäº† Objective-C ä»£ç ï¼Œä½†æ˜¯è¿™åªæ˜¯å›¾å—çš„ UIBezierPath è·¯å¾„ä»£ç ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ æ–‡å­—å’Œå›¾é’‰çš„ç›¸åº”ä½ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ PaintCode æ·»åŠ è¿™äº›å†…å®¹ã€‚</p>
<ul>
<li><h5 id="æ·»åŠ å¸‚å"><a href="#æ·»åŠ å¸‚å" class="headerlink" title="æ·»åŠ å¸‚å"></a>æ·»åŠ å¸‚å</h5><p>æ·»åŠ  Textï¼Œè®¾ç½®æ–‡å­—ï¼Œè°ƒèŠ‚æ–‡å­—ä½ç½®ä»¥åŠå­—ä½“å¤§å°ä¸º11ï¼ŒPaintCode ä¹Ÿè‡ªåŠ¨ç”Ÿæˆäº†ç›¸åº”çš„ä»£ç ã€‚</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191028001128976.png" alt="image-20191028001128976"></p>
</li>
<li><h5 id="æ·»åŠ å›¾é’‰ä½ç½®"><a href="#æ·»åŠ å›¾é’‰ä½ç½®" class="headerlink" title="æ·»åŠ å›¾é’‰ä½ç½®"></a>æ·»åŠ å›¾é’‰ä½ç½®</h5><p>æ·»åŠ å›¾é’‰ Rectï¼Œè°ƒèŠ‚ Rect çš„ä½ç½®ï¼Œå®½é«˜éƒ½è®¾ç½®ä¸º20ã€‚</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191028001948626.png" alt="image-20191028001948626"></p>
</li>
<li><h5 id="å¯¼å‡ºä»£ç "><a href="#å¯¼å‡ºä»£ç " class="headerlink" title="å¯¼å‡ºä»£ç "></a>å¯¼å‡ºä»£ç </h5><p>æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ·»åŠ å…¶ä»–çš„å¸‚åå’Œå›¾é’‰ä½ç½®ï¼Œå¹¶ä¸”å¯¼å‡ºä»£ç æ–‡ä»¶ã€‚</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191028002543468.png" alt="image-20191028002543468"></p>
</li>
</ul>
<h4 id="æ•´ç†ä»£ç æ–‡ä»¶"><a href="#æ•´ç†ä»£ç æ–‡ä»¶" class="headerlink" title="æ•´ç†ä»£ç æ–‡ä»¶"></a>æ•´ç†ä»£ç æ–‡ä»¶</h4><p>PaintCode ç”Ÿæˆçš„æ–‡ä»¶åŒ…å«äº†å›¾å—ï¼Œæ–‡å­—ï¼Œå›¾é’‰ä¸‰é¡¹å†…å®¹çš„ç»˜åˆ¶ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸‰é¡¹å†…å®¹è¿›è¡ŒæŠ½å–å’Œæ•´ç†ï¼Œè¿™é‡Œä»¥ç¦å»ºçœä¸ºä¾‹ã€‚</p>
<pre class=" language-objective-c"><code class="language-objective-c">+ (void)drawCanvas2WithFrame: (CGRect)targetFrame resizing: (FujianResizingBehavior)resizing
{
    //// General Declarations
    CGContextRef context = UIGraphicsGetCurrentContext();

    //// Resize to Target Frame
    CGContextSaveGState(context);
    CGRect resizedFrame = FujianResizingBehaviorApply(resizing, CGRectMake(0, 0, 308, 340), targetFrame);
    CGContextTranslateCTM(context, resizedFrame.origin.x, resizedFrame.origin.y);
    CGContextScaleCTM(context, resizedFrame.size.width / 308, resizedFrame.size.height / 340);

UIColor* strokeColor = [UIColor colorWithRed: 0.8 green: 0.8 blue: 0.8 alpha: 1];
    UIColor* fillColor = [UIColor colorWithRed: 0.486 green: 0.71 blue: 0.925 alpha: 1];

    //// é¡µé¢1
    {
        //// chart-(1)
        {
            //// Clipped
            {
                //// Group ç¼–ç»„ 5
                {
                    //// Group 6
                    {
                        //// Bezier å½¢çŠ¶ 2 Drawing
                        UIBezierPath* bezier2Path = [UIBezierPath bezierPath];
                        [bezier2Path moveToPoint: CGPointMake(215.48, 200.9)];
                        [bezier2Path addLineToPoint: CGPointMake(214.85, 200.27)];
                        [bezier2Path addLineToPoint: CGPointMake(215.17, 199.01)];
                        [bezier2Path addLineToPoint: CGPointMake(215.8, 199.32)];
                        [bezier2Path addLineToPoint: CGPointMake(216.43, 198.06)];

                      ......
                        [bezier2Path closePath];
                        [bezier2Path moveToPoint: 
                        [bezier2Path closePath];
                        [fillColor setFill];
                        [bezier2Path fill];
                        [strokeColor setStroke];
                        bezier2Path.lineWidth = 1;
                        bezier2Path.miterLimit = 4;
                        [bezier2Path stroke];
                                             }
                         ......
                }
            }
        }
    }

                          //// Text Drawing
    CGRect textRect = CGRectMake(128, 71, 39, 26);
    {
        NSString* textContent = @"å—å¹³å¸‚";
        NSMutableParagraphStyle* textStyle = [[NSMutableParagraphStyle alloc] init];
        textStyle.alignment = NSTextAlignmentLeft;
        NSDictionary* textFontAttributes = @{NSFontAttributeName: [UIFont systemFontOfSize: 11], NSForegroundColorAttributeName: UIColor.blackColor, NSParagraphStyleAttributeName: textStyle};

        CGFloat textTextHeight = [textContent boundingRectWithSize: CGSizeMake(textRect.size.width, INFINITY) options: NSStringDrawingUsesLineFragmentOrigin attributes: textFontAttributes context: nil].size.height;
        CGContextSaveGState(context);
        CGContextClipToRect(context, textRect);
        [textContent drawInRect: CGRectMake(CGRectGetMinX(textRect), CGRectGetMinY(textRect) + (textRect.size.height - textTextHeight) / 2, textRect.size.width, textTextHeight) withAttributes: textFontAttributes];
        CGContextRestoreGState(context);
    }

                         ......
                         //// Rectangle Drawing
    UIBezierPath* rectanglePath = [UIBezierPath bezierPathWithRect: CGRectMake(135, 56, 20, 20)];
    [UIColor.grayColor setFill];
    [rectanglePath fill];
                                               ......
        CGContextRestoreGState(context);

}

</code></pre>
<ol>
<li><h5 id="æ–°å»ºä¸€ä¸ª-FujianMapPath-æ–‡ä»¶ç»§æ‰¿äº-ChinaMapPath-ç±»ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å­˜æ”¾æ•´ç†åˆ†ç±»åçš„ä»£ç "><a href="#æ–°å»ºä¸€ä¸ª-FujianMapPath-æ–‡ä»¶ç»§æ‰¿äº-ChinaMapPath-ç±»ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å­˜æ”¾æ•´ç†åˆ†ç±»åçš„ä»£ç " class="headerlink" title="æ–°å»ºä¸€ä¸ª FujianMapPath æ–‡ä»¶ç»§æ‰¿äº ChinaMapPath ç±»ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å­˜æ”¾æ•´ç†åˆ†ç±»åçš„ä»£ç "></a>æ–°å»ºä¸€ä¸ª FujianMapPath æ–‡ä»¶ç»§æ‰¿äº ChinaMapPath ç±»ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å­˜æ”¾æ•´ç†åˆ†ç±»åçš„ä»£ç </h5></li>
<li><h5 id="å›¾å—éƒ¨åˆ†"><a href="#å›¾å—éƒ¨åˆ†" class="headerlink" title="å›¾å—éƒ¨åˆ†"></a>å›¾å—éƒ¨åˆ†</h5><p>æˆ‘ä»¬åªéœ€è¦æ‘˜å– <code>UIBezierPath</code> çš„è·¯å¾„éƒ¨åˆ†ä»£ç å³å¯ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª <code>bezierPath</code> åœ¨ä»¥ä¸‹ä»£ç ä¹‹å‰çš„è·¯å¾„ä»£ç (æ¢ä¸ªè¯´æ³•å°±æ˜¯åˆ é™¤æ¯ä¸ª<code>bezierPath</code> çš„ä»¥ä¸‹ä»£ç )</p>
<pre class=" language-objective-c"><code class="language-objective-c">                        [fillColor setFill];
                        [bezier2Path fill];
                        [strokeColor setStroke];
                        bezier2Path.lineWidth = 1;
                        bezier2Path.miterLimit = 4;
                        [bezier2Path stroke];
</code></pre>
<p>æ•´ç†åçš„ <code>bezierPath</code> æ”¾åœ¨ <code>FujianMapPath</code> çš„ <code>pathArray</code> ä¸­ã€‚</p>
</li>
<li><h5 id="æ–‡å­—éƒ¨åˆ†"><a href="#æ–‡å­—éƒ¨åˆ†" class="headerlink" title="æ–‡å­—éƒ¨åˆ†"></a>æ–‡å­—éƒ¨åˆ†</h5><p>æˆ‘ä»¬åªéœ€è¦æ‘˜å–æ¯æ®µ <code>textRect</code> çš„ frame å³å¯ï¼Œ</p>
<pre class=" language-objective-c"><code class="language-objective-c">CGRect textRect = CGRectMake(128, 71, 39, 26);
</code></pre>
<p>æ•´ç†åçš„ <code>textRect</code> æ”¾åœ¨ <code>FujianMapPath</code> çš„ <code>textRectArray</code> ä¸­ï¼Œä½¿ç”¨ <code>NSValue</code>å­˜å‚¨ã€‚æ–‡å­—å†…å®¹éœ€è¦å¦å¤–å­˜å‚¨åœ¨åœ¨ <code>FujianMapPath</code> çš„ <code>textArray</code> ä¸­ã€‚</p>
</li>
<li><h5 id="å›¾é’‰éƒ¨åˆ†"><a href="#å›¾é’‰éƒ¨åˆ†" class="headerlink" title="å›¾é’‰éƒ¨åˆ†"></a>å›¾é’‰éƒ¨åˆ†</h5><p>æˆ‘ä»¬åªéœ€è¦æ‘˜å–æ¯æ®µ <code>rectanglePath</code> çš„èµ·å§‹ç‚¹å³å¯ï¼Œ</p>
<pre class=" language-objective-c"><code class="language-objective-c">UIBezierPath* rectanglePath = [UIBezierPath bezierPathWithRect: CGRectMake(135, 56, 20, 20)];
=>  CGPointMake(135, 56)
</code></pre>
<p>æ•´ç†åçš„ <code>point</code> æ”¾åœ¨ <code>FujianMapPath</code> çš„ <code>pinPointArray</code> ä¸­ã€‚</p>
</li>
</ol>
<p><strong><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è‡ªè¡Œç»˜åˆ¶çš„æ–‡å­—éƒ¨åˆ†å’Œå›¾å—éƒ¨åˆ†çš„å¸‚åŒºé¡ºåºä¸€èˆ¬æ˜¯ä¸ä¸€è‡´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ ¹æ®å›¾å—é¡ºåºè°ƒæ¢ textArrayã€textRectArray å’Œ  pinPointArray ä¸­å¸‚åŒºçš„é¡ºåº</em></strong></p>
<h4 id="ä½¿ç”¨-CXProvincesMapView-å±•ç¤ºæˆ‘ä»¬è·å–çš„ä»£ç æ•°æ®"><a href="#ä½¿ç”¨-CXProvincesMapView-å±•ç¤ºæˆ‘ä»¬è·å–çš„ä»£ç æ•°æ®" class="headerlink" title="ä½¿ç”¨ CXProvincesMapView å±•ç¤ºæˆ‘ä»¬è·å–çš„ä»£ç æ•°æ®"></a>ä½¿ç”¨ CXProvincesMapView å±•ç¤ºæˆ‘ä»¬è·å–çš„ä»£ç æ•°æ®</h4><pre class=" language-objective-c"><code class="language-objective-c">/// è‡ªå®šä¹‰çš„åœ°å›¾å¿«æ·åˆ›å»ºæ–¹æ³•
/// @param mapPath svg ç»˜å›¾æ•°æ®
/// @param mapSize svg ç»˜å›¾å°ºå¯¸ï¼Œå³ svg æ–‡ä»¶ä¸­å›¾å±‚çš„å®½é«˜
/// @param frame   è§†å›¾æ§ä»¶çš„frame
- (instancetype)initWithMapPath:(ChinaMapPath *)mapPath andMapSize:(CGSize)mapSize andFrame:(CGRect)frame;
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre class=" language-objective-c"><code class="language-objective-c">- (void)viewDidLoad {
    [super viewDidLoad];
    self.view.backgroundColor = [UIColor whiteColor];
    // ç¦å»ºçœå¸‚æ•°æ®
    FujianMapPath *mapPath = [[FujianMapPath alloc] init];
    self.chinaMapView = [[CXProvincesMapView alloc]initWithMapPath:mapPath andMapSize:CGSizeMake(308, 340) andFrame:CGRectMake(0, 0, self.view.bounds.size.width, 400)];
    _chinaMapView.backgroundColor = [UIColor colorWithRed:230/255.0 green:1.0 blue:1.0 alpha:1.0];
    _chinaMapView.maximumZoomScale = 5.0;
    _chinaMapView.center = self.view.center;
    _chinaMapView.delegate = self;
    //    _chinaMapView.pinAnimation = NO;
    // ç›´æ¥è®¾ç½®å›¾ç‰‡
    //    _chinaMapView.pinImage = [UIImage imageNamed:@"pin"];
    // æ·»åŠ æŒ‰é’®ç‚¹å‡»
    UIButton *pinButton = [[UIButton alloc]initWithFrame:_chinaMapView.pinView.bounds];
    [pinButton setImage:[UIImage imageNamed:@"pin"] forState:UIControlStateNormal];
    [pinButton addTarget:self action:@selector(pinTest) forControlEvents:UIControlEventTouchUpInside];
    [_chinaMapView.pinView addSubview:pinButton];
    [self.view addSubview:_chinaMapView];
}
</code></pre>
<p>æ•ˆæœï¼š</p>
<p><img src="/CXTretar/CXTretar.github.io/2019/10/27/shi-yong-paintcode-hui-zhi-zi-ding-yi-de-sheng-fen-di-tu-kong-jian/image-20191028011542388.png" alt="image-20191028011542388"></p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä»¥ä¸Šæ­¥éª¤çœ‹èµ·æ¥ç¹çï¼Œå®é™…ä¸Šæ“ä½œèµ·æ¥å¹¶ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦çš„ä»£ç éƒ¨åˆ† PaintCode å·²ç»ä¸ºæˆ‘ä»¬ç”Ÿæˆå¥½äº†ï¼Œå¯ä»¥åœ¨æœ‰ svg å›¾ç‰‡çš„å‰æä¸‹ç”Ÿæˆä»»æ„çš„åœ°å›¾åŒºåŸŸæ§ä»¶ï¼Œ<code>CXProvincesMapView</code> ä¸­å›½çœä»½åœ°å›¾åŒºåŸŸçš„æ§ä»¶ä¹Ÿæ˜¯è¿™æ ·å­ç”Ÿæˆçš„ã€‚å‡å¦‚ä½ ä¸éœ€è¦æ–‡å­—æˆ–è€…å›¾é’‰éƒ¨åˆ†ï¼Œä½ å¯ä»¥ä¸ç”¨å¦å¤–ç»˜åˆ¶æ–‡å­—æˆ–è€…å›¾é’‰ï¼Œç›¸å¯¹åº”çš„æ•°ç»„ä¼ å…¥ç©ºå€¼å°±è¡Œäº†ã€‚</p>
<p>å®Œç»“æ•£èŠ±(<em>^â–½^</em>)ï¼Œå¸Œæœ›è¿™ç¯‡æ•™ç¨‹å¯¹ä½ æœ‰å¸®åŠ©ï¼</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Runtimeçš„è¿ç”¨ï¼ˆä¸€ï¼‰ä¸ºCategoryå¢åŠ å…³è”å¯¹è±¡</title>
    <url>/2020/03/04/runtime-de-yun-yong-yi/</url>
    <content><![CDATA[<h2 id="Category-çš„å†…éƒ¨ç»“æ„"><a href="#Category-çš„å†…éƒ¨ç»“æ„" class="headerlink" title="Category çš„å†…éƒ¨ç»“æ„"></a>Category çš„å†…éƒ¨ç»“æ„</h2><p>ä¸‹è½½ <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">objc4</a>æºç ï¼Œåœ¨<code>objc-runtime-new.h</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Categoryçš„å†…éƒ¨ç»“æ„ï¼š</p>
<pre class=" language-objective-c"><code class="language-objective-c">struct category_t {
    const char *name;
    classref_t cls;
    struct method_list_t *instanceMethods;
    struct method_list_t *classMethods;
    struct protocol_list_t *protocols;
    struct property_list_t *instanceProperties;
    // Fields below this point are not always present on disk.
    struct property_list_t *_classProperties;

    method_list_t *methodsForMeta(bool isMeta) {
        if (isMeta) return classMethods;
        else return instanceMethods;
    }

    property_list_t *propertiesForMeta(bool isMeta, struct header_info *hi);

    protocol_list_t *protocolsForMeta(bool isMeta) {
        if (isMeta) return nullptr;
        else return protocols;
    }
};
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒCategoryå†…éƒ¨å«æœ‰<strong>method_list_t</strong>ï¼Œ<strong>protocol_list_t</strong>ï¼Œ<strong>property_list_t</strong> è¿™æ ·çš„ç»“æ„ä½“ï¼Œä¸åŸç±»ç›¸æ¯”å”¯ç‹¬ç¼ºå°‘äº†<strong>ivars</strong>ï¼Œæ‰€ä»¥é€šè¿‡Categoryå¯ä»¥ç»™ç±»æ·»åŠ æ–¹æ³•ï¼Œåè®®ï¼Œå±æ€§ï¼Œä½†æ˜¯ç”±äºåˆ†ç±»åº•å±‚ç»“æ„çš„é™åˆ¶ï¼Œä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡åˆ°åˆ†ç±»ä¸­ã€‚</p>
<p>è¯´åˆ°è¿™é‡Œï¼Œæœ‰äº›åŒå­¦å¯èƒ½å°±ä¼šé—®äº†ï¼Œåœ¨æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œæ·»åŠ å±æ€§ä¸å°±å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡äº†å—ï¼Ÿ</p>
<p>åœ¨è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œè€Œç»™Categoryæ·»åŠ å±æ€§ï¼Œåªæ˜¯å¯¹è¯¥å±æ€§çš„setter/getteræ–¹æ³•åšäº†å£°æ˜ï¼Œæ—¢æ²¡æœ‰æ·»åŠ æˆå‘˜å˜é‡ï¼Œä¹Ÿæ²¡æœ‰å¯¹setter/getteræ–¹æ³•åšå®ç°ã€‚ä¾‹å¦‚åœ¨ <strong>Person+Jump.h</strong> ä¸­å£°æ˜äº†ä¸€ä¸ªå±æ€§ <strong>name</strong></p>
<pre class=" language-objective-c"><code class="language-objective-c">#import "Person.h"

@interface Person (Jump)

@property (nonatomic, copy) NSString *name;

@end

@implementation Person (Jump)

@end

</code></pre>
<p>å®é™…ä¸Šç­‰ä»·äºç»™ç±»æ·»åŠ äº†ä¸¤ä¸ªæ–¹æ³•å£°æ˜ï¼š</p>
<pre class=" language-objective-c"><code class="language-objective-c">#import "Person.h"

@interface Person (Jump)

@property (nonatomic, copy) NSString *name;

- (void)setName:(NSString *)name;
- (NSString *)name;

@end

@implementation Person (Jump)

@end
</code></pre>
<p>ç”±äºå¹¶æ²¡æœ‰å¯¹ <strong>name </strong>çš„ <strong>setter/getter </strong>æ–¹æ³•è¿›è¡Œå®ç°ï¼Œæ­£å¸¸ä½¿ç”¨ <strong>person.name</strong>ï¼Œä¼šäº§ç”Ÿé”™è¯¯ã€‚</p>
<blockquote>
<p>Terminating app due to uncaught exception â€˜NSInvalidArgumentExceptionâ€™, reason: â€˜-[Person setName:]: unrecognized selector sent to instance 0x10063f5b0â€™</p>
</blockquote>
<h4 id="é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬åœ¨-implementationä¸­å®ç°äº†-setter-getter-æ–¹æ³•æ˜¯ä¸æ˜¯å°±èƒ½å®ç°ç±»ä¼¼äºç»™åˆ†ç±»æ·»åŠ æˆå‘˜å˜é‡å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬åœ¨-implementationä¸­å®ç°äº†-setter-getter-æ–¹æ³•æ˜¯ä¸æ˜¯å°±èƒ½å®ç°ç±»ä¼¼äºç»™åˆ†ç±»æ·»åŠ æˆå‘˜å˜é‡å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬åœ¨@implementationä¸­å®ç°äº† setter/getter æ–¹æ³•æ˜¯ä¸æ˜¯å°±èƒ½å®ç°ç±»ä¼¼äºç»™åˆ†ç±»æ·»åŠ æˆå‘˜å˜é‡å‘¢ï¼Ÿ"></a>é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬åœ¨@implementationä¸­å®ç°äº† setter/getter æ–¹æ³•æ˜¯ä¸æ˜¯å°±èƒ½å®ç°ç±»ä¼¼äºç»™åˆ†ç±»æ·»åŠ æˆå‘˜å˜é‡å‘¢ï¼Ÿ</h4><p><strong>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¿™é‡Œè¦æ˜ç¡®çš„æ˜¯æˆ‘ä»¬æ˜¯æ— æ³•é€šè¿‡Categoryç»™ç±»æ·»åŠ æˆå‘˜å˜é‡çš„ï¼Œæˆ‘ä»¬åªæ˜¯æ¨¡æ‹Ÿäº†æˆå‘˜å˜é‡çš„è°ƒç”¨ï¼Œå®é™…ä¸Šç±»ä¸­çš„ivarså¹¶æ²¡æœ‰æ”¹å˜ï¼Œä»¥ä¸‹ä»‹ç»ä¸¤ç§å®ç°æ–¹å¼ã€‚</strong></p>
<h2 id="é€šè¿‡å…¨å±€å˜é‡å®ç°"><a href="#é€šè¿‡å…¨å±€å˜é‡å®ç°" class="headerlink" title="é€šè¿‡å…¨å±€å˜é‡å®ç°"></a>é€šè¿‡å…¨å±€å˜é‡å®ç°</h2><p>ä¸»è¦å®ç°åŸç†æ˜¯é€šè¿‡è®¾ç½®ä¸€ä¸ªå…¨å±€çš„å¯å˜å­—å…¸ï¼Œå°†è¯¥åˆ†ç±»çš„åœ°å€å€¼å½“åškeyå€¼ï¼Œæ¥å­˜å‚¨æˆ‘ä»¬æ·»åŠ çš„å˜é‡çš„å…·ä½“å€¼ï¼Œè€Œåˆ†ç±»ä¸­å±æ€§çš„<strong>setter/getter</strong>æ–¹æ³•åˆ™é€šè¿‡è¯¥å­—å…¸æ¥èµ‹å€¼å’Œå–å€¼ã€‚å‡å¦‚æ·»åŠ äº†å¤šä¸ªå˜é‡ï¼Œå°±éœ€è¦è®¾ç½®å¤šä¸ªå¯å˜å­—å…¸ï¼Œä¸‹é¢ä¸¾ä¸ªä¾‹å­ã€‚</p>
<pre class=" language-objective-c"><code class="language-objective-c">#import "Person.h"

@interface Person (Test2)

@property(nonatomic, copy) NSString *nickName;

@property(nonatomic, assign) float weight;

@end

@implementation Person (Test2)

NSMutableDictionary *weights;
NSMutableDictionary *nickNames;

+ (void)load {
    weights = [NSMutableDictionary dictionary];
    nickNames = [NSMutableDictionary dictionary];
}

- (void)setWeight:(float)weight {

    NSString *key = [NSString stringWithFormat:@"%p", self];
    weights[key] = @(weight);
}

- (float)weight {
    NSString *key = [NSString stringWithFormat:@"%p", self];
    return [weights[key] floatValue];
}

- (void)setNickName:(NSString *)nickName {
    NSString *key = [NSString stringWithFormat:@"%p", self];
    nickNames[key] = nickName;
}

- (NSString *)nickName {
    NSString *key = [NSString stringWithFormat:@"%p", self];
    return nickNames[key];
}

@end
</code></pre>
<p>åœ¨è°ƒç”¨æ—¶ï¼Œä¹Ÿèƒ½å®ç°æ­£å¸¸çš„èµ‹å€¼å’Œå–å€¼ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class=" language-objective-c"><code class="language-objective-c">Person *person = [[Person alloc] init];
person.nickName = @"NickJack";
person.weight = 70.5;
NSLog(@"nickName - %@ weight - %f", person.nickName, person.weight);
</code></pre>
<p><strong>ä½†æ˜¯è¿™æ ·çš„æ–¹å¼å­˜åœ¨ä¸€äº›å¼Šç«¯ï¼š</strong></p>
<ul>
<li><strong>çº¿ç¨‹å®‰å…¨é£é™©</strong>  ç”±äºæ˜¯å…¨å±€å­—å…¸å¯¹è±¡ï¼Œå­˜åœ¨åœ¨å¤šçº¿ç¨‹ä¸­å¯¹åŒä¸€ä¸ªå­—å…¸å¯¹è±¡è¿›è¡ŒåŒæ—¶è¯»å†™çš„é£é™©ã€‚</li>
<li><strong>å†…å­˜æ³„éœ²é£é™©</strong>  å…¨å±€å­—å…¸å¯¹è±¡éœ€è¦ä¸€ç›´å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ— è®ºæ˜¯å¦ä½¿ç”¨è¯¥åˆ†ç±»éƒ½ä¼šå ç”¨å†…å­˜ã€‚</li>
<li><strong>ä¹¦å†™éº»çƒ¦</strong>          æ¯æ·»åŠ ä¸€ä¸ªå˜é‡ï¼Œå°±å¿…é¡»è®¾ç½®ä¸€ä¸ªæ–°çš„å¯å˜å­—å…¸æ¥å­˜æ”¾ï¼Œå¢åŠ ä»£ç é‡ã€‚</li>
</ul>
<blockquote>
<p><strong>å°ç»“ï¼šä½¿ç”¨å…¨å±€å˜é‡æ–¹å¼æ·»åŠ ï¼Œä¸ä»…ä»£ç ä¹¦å†™éº»çƒ¦ï¼Œè€Œä¸”å­˜åœ¨ä¸€äº›ä½¿ç”¨é£é™©ï¼Œä¸‹é¢æ¥çœ‹ä¸‹é€šè¿‡å…³è”å¯¹è±¡å¦‚ä½•å®ç°ã€‚</strong></p>
</blockquote>
<h2 id="é€šè¿‡å…³è”å¯¹è±¡å®ç°"><a href="#é€šè¿‡å…³è”å¯¹è±¡å®ç°" class="headerlink" title="é€šè¿‡å…³è”å¯¹è±¡å®ç°"></a>é€šè¿‡å…³è”å¯¹è±¡å®ç°</h2><p>æˆ‘ä»¬åœ¨å¼€å‘ä¸­æœ€å¸¸ç”¨çš„è¿˜æ˜¯è¿™ç§æ–¹å¼ï¼Œ<strong>Runtime </strong>ä¸ºæˆ‘ä»¬æä¾›äº†åŠ¨æ€æ·»åŠ å±æ€§å’Œè·å¾—å±æ€§çš„æ–¹æ³•ã€‚</p>
<h4 id="æ·»åŠ å…³è”å¯¹è±¡"><a href="#æ·»åŠ å…³è”å¯¹è±¡" class="headerlink" title="æ·»åŠ å…³è”å¯¹è±¡"></a>æ·»åŠ å…³è”å¯¹è±¡</h4><pre class=" language-objective-c"><code class="language-objective-c">objc_setAssociatedObject(id  _Nonnull object, const void * _Nonnull key, id  _Nullable value, objc_AssociationPolicy policy)
</code></pre>
<p><strong>id object</strong> :  ç»™å“ªä¸ªç±»æ·»åŠ å…³è”å¯¹è±¡ï¼Œåœ¨åˆ†ç±»ä¸€èˆ¬ä¼ å…¥ <strong>self</strong>ã€‚</p>
<p><strong>const void * _Nonnull key</strong> :  å…³è”å¯¹è±¡çš„ <strong>key</strong> ï¼Œæ ¹æ® <strong>key</strong> è®¾ç½®å¯¹åº”å…³è”å¯¹è±¡çš„å€¼è¿›è¡Œå­˜å‚¨ï¼Œå¯ä»¥ä¼ å…¥è¯¥å…³è”å¯¹è±¡å¯¹åº”çš„ <strong>getter </strong>æ–¹æ³•åœ°å€ç®€åŒ–ä»£ç ï¼Œä¾‹å¦‚<code>@selector(name)</code>ã€‚</p>
<p><strong>id  _Nullable value</strong>ï¼šå…³è”å¯¹è±¡çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ <strong>setter</strong> æ–¹æ³•ä¼ å…¥çš„å€¼ç»™å…³è”å¯¹è±¡å»å­˜å‚¨ï¼Œè¿™é‡Œå­˜å‚¨çš„å¿…é¡»æ˜¯å¯¹è±¡ï¼Œä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹ã€‚</p>
<p><strong>objc_AssociationPolicy policy</strong>ï¼šå…³è”ç­–ç•¥ï¼Œå…³è”å¯¹è±¡ä»¥ä»€ä¹ˆå½¢å¼ä¿å­˜ï¼Œå…·ä½“çš„å…³è”ç­–ç•¥æœ‰ä»¥ä¸‹å‡ ç§ï¼Œéœ€è¦æ³¨æ„çš„å¹¶æ²¡æœ‰æˆ‘ä»¬å±æ€§ä¸­å¸¸è§çš„ <strong>weak</strong> ç±»å‹ã€‚</p>
<pre class=" language-objective-c"><code class="language-objective-c">typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) {
    OBJC_ASSOCIATION_ASSIGN = 0,           /**< Specifies a weak reference to the associated object. */
    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, /**< Specifies a strong reference to the associated object. 
                                            *   The association is not made atomically. */
    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,   /**< Specifies that the associated object is copied. 
                                            *   The association is not made atomically. */
    OBJC_ASSOCIATION_RETAIN = 01401,       /**< Specifies a strong reference to the associated object.
                                            *   The association is made atomically. */
    OBJC_ASSOCIATION_COPY = 01403          /**< Specifies that the associated object is copied.
                                            *   The association is made atomically. */
};
</code></pre>
<h4 id="è·å–å…³è”å¯¹è±¡"><a href="#è·å–å…³è”å¯¹è±¡" class="headerlink" title="è·å–å…³è”å¯¹è±¡"></a>è·å–å…³è”å¯¹è±¡</h4><pre class=" language-objective-c"><code class="language-objective-c">id objc_getAssociatedObject(id object, const void * key)
</code></pre>
<p><strong>id object</strong> : è·å–æŸä¸ªç±»é‡Œé¢çš„å…³è”å¯¹è±¡ã€‚</p>
<p><strong>const void * _Nonnull key</strong> : å…³è”å¯¹è±¡çš„ <strong>key</strong> ï¼Œä¸ <strong>objc_setAssociatedObject</strong> ä¸­çš„ <strong>key</strong> ç›¸å¯¹åº”ï¼Œå³é€šè¿‡ <strong>key</strong> å€¼å–å‡º <strong>value</strong>ã€‚</p>
<h4 id="ç§»é™¤æ‰€æœ‰çš„å…³è”å¯¹è±¡"><a href="#ç§»é™¤æ‰€æœ‰çš„å…³è”å¯¹è±¡" class="headerlink" title="ç§»é™¤æ‰€æœ‰çš„å…³è”å¯¹è±¡"></a>ç§»é™¤æ‰€æœ‰çš„å…³è”å¯¹è±¡</h4><pre class=" language-objective-c"><code class="language-objective-c">void objc_removeAssociatedObjects(id object)
</code></pre>
<p><strong>id object</strong>ï¼šç§»é™¤æŸä¸ªç±»é‡Œé¢çš„æ‰€æœ‰å…³è”å¯¹è±¡ã€‚</p>
<h4 id="æ·»åŠ å…³è”å¯¹è±¡çš„ä½¿ç”¨ç¤ºä¾‹ï¼š"><a href="#æ·»åŠ å…³è”å¯¹è±¡çš„ä½¿ç”¨ç¤ºä¾‹ï¼š" class="headerlink" title="æ·»åŠ å…³è”å¯¹è±¡çš„ä½¿ç”¨ç¤ºä¾‹ï¼š"></a>æ·»åŠ å…³è”å¯¹è±¡çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</h4><pre class=" language-objective-c"><code class="language-objective-c">#import <objc/runtime.h>
#import "Person.h"

@interface Person (Test)

@property(nonatomic, copy) NSString *name;
@property(nonatomic, assign) float height;

@end

@implementation Person (Test)

- (void)setName:(NSString *)name {
    objc_setAssociatedObject(self, @selector(name), name, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

- (NSString *)name {
   return objc_getAssociatedObject(self, @selector(name));
}

- (void)setHeight:(float)height {
    objc_setAssociatedObject(self, @selector(height), @(height), OBJC_ASSOCIATION_ASSIGN);
}

- (float)height {
    return [objc_getAssociatedObject(self, @selector(height)) floatValue];
}

@end
</code></pre>
<blockquote>
<p><strong>å°ç»“ï¼šä½¿ç”¨å…³è”å¯¹è±¡æ¥æ·»åŠ æˆå‘˜å˜é‡çš„æ“ä½œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ¢ç©¶ä¸‹å…³è”å¯¹è±¡çš„åº•å±‚å®ç°åŸç†ã€‚</strong></p>
</blockquote>
<h2 id="å…³è”å¯¹è±¡å®ç°åŸç†"><a href="#å…³è”å¯¹è±¡å®ç°åŸç†" class="headerlink" title="å…³è”å¯¹è±¡å®ç°åŸç†"></a>å…³è”å¯¹è±¡å®ç°åŸç†</h2><p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸‹è½½ <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">objc4</a> æºç æŸ¥çœ‹<code>objc-references.mm</code>æ¥æ¢ç©¶å…³è”å¯¹è±¡çš„åº•å±‚ç»“æ„ï¼Œè€ƒè™‘åˆ°æºç è§£è¯»æ¯”è¾ƒæ™¦æ¶©ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ç»“è®ºã€‚</p>
<p><strong>å®ç°å…³è”å¯¹è±¡æŠ€æœ¯çš„æ ¸å¿ƒå¯¹è±¡æœ‰</strong></p>
<ul>
<li>AssociationsManager</li>
<li>AssociationsHashMap</li>
<li>ObjectAssociationMap</li>
<li>ObjcAssociation</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯ - iOS - runtime</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå®šä¹‰NSURLProtocolå®ç°WebViewç¼“å­˜ä»¥åŠç§‘å­¦ä¸Šç½‘</title>
    <url>/2018/07/20/zi-ding-yi-nsurlprotocol-shi-xian-wang-ye-huan-cun-yi-ji-ke-xue-shang-wang/</url>
    <content><![CDATA[<h4 id="NSURLProtocolæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#NSURLProtocolæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="NSURLProtocolæ˜¯ä»€ä¹ˆï¼Ÿ"></a>NSURLProtocolæ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>NSURLProtocolæ˜¯ iOSé‡Œé¢çš„<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html" target="_blank" rel="noopener">URL Loading System</a>çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½å»å®ä¾‹åŒ–å®ƒï¼Œåªèƒ½å­ç±»åŒ–NSURLProtocolï¼Œç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™æ³¨å†Œå­ç±»ã€‚</p>
<p><img src="/CXTretar/CXTretar.github.io/2018/07/20/zi-ding-yi-nsurlprotocol-shi-xian-wang-ye-huan-cun-yi-ji-ke-xue-shang-wang/NSURLProtocol.png" alt="NSURLProtocol"></p>
<h4 id="NSURLProtocolèƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#NSURLProtocolèƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="NSURLProtocolèƒ½åšä»€ä¹ˆï¼Ÿ"></a>NSURLProtocolèƒ½åšä»€ä¹ˆï¼Ÿ</h4><p>åœ¨æ¯ä¸€ä¸ª <code>HTTP</code> è¯·æ±‚å¼€å§‹æ—¶ï¼Œ<code>URL Loading System</code> ä¼šåˆ›å»ºä¸€ä¸ªåˆé€‚çš„ <code>NSURLProtocol</code> å¯¹è±¡å¤„ç†å¯¹åº”çš„ URL è¯·æ±‚ï¼Œè€Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å†™ä¸€ä¸ªç»§æ‰¿è‡ª <code>NSURLProtocol</code> çš„ç±»ï¼Œå¹¶é€šè¿‡ <code>- registerClass:</code> æ–¹æ³•æ³¨å†Œæˆ‘ä»¬çš„åè®®ç±»ï¼Œç„¶å <code>URL Loading System</code> å°±ä¼šåœ¨è¯·æ±‚å‘å‡ºæ—¶ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„ <code>NSURLProtocol</code> å¯¹è±¡å¯¹è¯¥è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>NSURLProtocol</code> æ¥å¤„ç†æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚ï¼Œå®ç°ä»¥ä¸‹ä¸€äº›åŠŸèƒ½ï¼š</p>
<ul>
<li>å¯ä»¥æ‹¦æˆª UIWebView çš„ç½‘ç»œè¯·æ±‚ã€‚</li>
<li>é‡å®šå‘ç½‘ç»œè¯·æ±‚ï¼ˆå¯ä»¥è§£å†³ DNS åŸŸååŠ«æŒé—®é¢˜ï¼‰</li>
<li>ç¼“å­˜ç½‘é¡µå†…å®¹</li>
<li>è‡ªå®šä¹‰ Response ï¼ˆè¿‡æ»¤æ•æ„Ÿä¿¡æ¯ï¼‰</li>
<li>å…¨å±€ç½‘ç»œè¯·æ±‚è®¾ç½®</li>
</ul>
<p>è‹¹æœå®˜æ–¹æ–‡æ¡£ä¸­çš„ <a href="https://developer.apple.com/library/ios/samplecode/CustomHTTPProtocol/CustomHTTPProtocol.zip" target="_blank" rel="noopener">CustomHTTPProtocol</a> å¯¹è‡ªå®šä¹‰ <code>NSURLProtocol</code> æœ‰äº†ä¸€äº›å…·ä½“çš„ä»‹ç»ï¼Œä½ å¯ä»¥ç‚¹å‡»<a href="https://developer.apple.com/library/ios/samplecode/CustomHTTPProtocol/CustomHTTPProtocol.zip" target="_blank" rel="noopener">è¿™é‡Œ</a>ä¸‹è½½æºä»£ç ã€‚</p>
<p>åŸºäºå®˜æ–¹çš„ Demoï¼Œæˆ‘ä»¬æ¥å¯¹ <code>NSURLProtocol</code> åšè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œä½¿å…¶èƒ½å¤Ÿå¯¹æˆ‘ä»¬è¯·æ±‚çš„ç½‘é¡µå†…å®¹ç¼“å­˜ï¼Œç”šè‡³å¯ä»¥é€šè¿‡è¿æ¥ä»£ç†æœåŠ¡å™¨æ¥ç§‘å­¦ä¸Šç½‘ï¼Œéœ€è¦æé†’çš„æ˜¯ï¼Œè¿™é‡Œçš„ç§‘å­¦ä¸Šç½‘åªèƒ½å¤Ÿåœ¨æ³¨å†Œè¯¥ <code>NSURLProtocol</code> çš„æ¡ä»¶ä¸‹å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯ App å†…éƒ¨çš„ç½‘é¡µå¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡å™¨è¯·æ±‚æ‰“å¼€ã€‚</p>
<p><a href="https://github.com/CXTretar/CXProxyURLProtocol">é¡¹ç›®åœ°å€</a> </p>
<h4 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><ul>
<li>åœ¨éœ€è¦å¼€å¯ä»£ç†çš„æ—¶å€™æ³¨å†Œ <code>CXProxyURLProtocol</code> ã€‚</li>
</ul>
<pre class=" language-objective-c"><code class="language-objective-c">[CXProxyProtocolManager registerProxyURLProtocol];
</code></pre>
<ul>
<li>åœ¨éœ€è¦å…³é—­ä»£ç†çš„æ—¶å€™æ³¨é”€ <code>CXProxyURLProtocol</code> ã€‚</li>
</ul>
<pre><code>[CXProxyProtocolManager unregisterProxyURLProtocol];
</code></pre><ul>
<li>è®¾ç½®æ‹¦æˆªçš„è¯·æ±‚æœåŠ¡ç±»å‹æˆ–è€…ä»£ç†æœåŠ¡å™¨ ip åœ°å€å’Œç«¯å£å·ã€‚</li>
</ul>
<pre><code>/**
 CXProxyURLProtocol å¯æ”¯æŒçš„URLSchemes

 @return URLSchemes
 */
+ (NSSet *)supportedSchemes;

/**
 è®¾ç½® CXProxyURLProtocol å¯æ”¯æŒçš„URLSchemes, é»˜è®¤ä¸º [http,https]

 @param supportedSchemes URLSchemes like: http https
 */
+ (void)setSupportedSchemes:(NSSet *)supportedSchemes;

/**
 è®¾ç½®ä»£ç†æœåŠ¡å™¨ipåœ°å€ä»¥åŠç«¯å£å· http/https è¿æ¥æ–¹å¼

 @param HTTPProxyHost ipåœ°å€
 @param HTTPProxyPort ç«¯å£å·
 */
+ (void)setHTTPProxyHost:(NSString *)HTTPProxyHost andHTTPProxyPort:(NSNumber *)HTTPProxyPort;
</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>iOSå¼€å‘</category>
      </categories>
      <tags>
        <tag>æŠ€æœ¯</tag>
        <tag>iOS</tag>
      </tags>
  </entry>
</search>
